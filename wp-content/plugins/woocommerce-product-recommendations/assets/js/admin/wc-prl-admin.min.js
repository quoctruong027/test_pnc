!function(e,t,n){function a(t,n,o){var i=this;if(t.length&&n.length){if(!(this instanceof a))return new a(t,n,o);this.templates=e.extend({row:"wc_prl_engine_%%type%%_filter_row",add:"wc_prl_engine_%%type%%_filter_add_content",row_content:"wc_prl_engine_%%type%%_filter_%%os_id%%_content"},o),this.os_add_templates={},this.os_row_templates={},this.os_row_content_templates={},this.$type_select=t,this.$data_container=n.length>1?n.first():n,this.$add_container=this.$data_container.find(".os_add"),this.$add_os_select=this.$data_container.find(".os_add select.os_type"),this.$list=this.$data_container.find("#os-list"),this.$boarding=this.$data_container.find(".os_boarding"),this.options_count=parseInt(this.$list.find(".os_row").length,10),this.$add_container.length&&this.$add_os_select.length&&this.$list.length&&(this.$list.prl_scripts(),this.$data_container.on("change_type",function(){var e=i.$type_select.val(),t=i.get_os_add_template(e)();i.$add_container.html("").append(t),i.reset_options(n)}),this.$data_container.on("mousedown",".os_remove .trash",function(){e(this).triggerHandler("mouseleave")}).on("click",".os_remove .trash",function(t){return t.preventDefault(),e(this).closest(".os_row").remove(),i.$data_container.trigger("os_remove"),i.options_count--,i.maybe_add_boarding(),!0}).on("change",".os_modifier select",function(){var t=e(this),n=t.val();$parent=t.closest(".os_row_inner"),$value_options=$parent.find(".os_value div[data-modifiers]"),$value_options.length&&($value_options.hide(),$value_options.each(function(){var t=e(this),a=t.data("modifiers").split(",");a&&-1!==a.indexOf(n)&&t.show()}))}).on("change",".os_add select.os_type",function(){var t=e(this),n=t.val(),a=i.$type_select.val();if("add"===n)return!1;var o=parseInt(i.$data_container.attr("data-os_count"),10)+1,r=i.$data_container.attr("data-os_post_name"),s=i.get_os_row_template(a),l=i.get_os_row_content_template(a,n);if(!s||!l)return!1;var c=s({os_index:o,os_content:l({os_post_name:r,os_index:o})});i.$data_container.attr("data-os_count",o),i.$list.append(c);var _=i.$list.find(".os_row").last();return _.find('.os_type option[value="'+n+'"]').prop("selected","selected"),i.$data_container.trigger("os_added"),_.prl_scripts(),i.options_count++,i.maybe_add_boarding(),t.find('option[value="add"]').prop("selected","selected"),!1}),this.$list.on("change","select.os_type",function(){var t=e(this),n=t.val(),a=t.closest(".os_row"),o=i.$data_container.attr("data-os_post_name"),r=a.data("os_index"),s=i.$type_select.val(),l=i.get_os_row_content_template(s,n);if(!l)return!1;var c=l({os_post_name:o,os_index:r});return a.find(".os_content").html(c),i.$data_container.trigger("os_changed"),a.prl_scripts(),!1}).on("click",".os_select_all",function(){return e(this).closest(".select-field").find("> select option").prop("selected","selected"),e(this).closest(".select-field").find("> select").trigger("change"),!1}).on("click",".os_select_none",function(){return e(this).closest(".select-field").find("> select option").removeAttr("selected"),e(this).closest(".select-field").find("> select").trigger("change"),!1}))}}e.fn.prl_scripts=function(){var t=e(this);t.sw_select2(),t.sw_enhanced_weight(),t.sw_enhanced_attribute(),t.find(".woocommerce-help-tip, .help_tip, .tips").tipTip({attribute:"data-tip",fadeIn:50,fadeOut:50,delay:200})},e.fn.maybe_disable_weight_selector=function(){var t=e(this).find(".os_row");2===t.length?t.first().find(".sw-enhanced-weight").addClass("disabled"):t.find(".sw-enhanced-weight").removeClass("disabled")},e.fn.sw_enhanced_weight=function(){var t=e(this).find(".sw-enhanced-weight");t.length&&t.each(function(){var t=e(this),n=t.find(".points"),a=t.find("span"),o=n.find("input"),i=parseInt(o.val(),10);if(o){var r=t.find(".dec"),s=t.find(".inc");r.on("click",function(){i>1&&(i-=1,a.each(function(t){i>=t+1?e(this).addClass("active"):e(this).removeClass("active")})),o.val(i)}),s.on("click",function(){i<5&&(i+=1,a.each(function(t){i>=t+1?e(this).addClass("active"):e(this).removeClass("active")})),o.val(i)})}})},e.fn.sw_enhanced_attribute=function(){var t=e(this).find(".os_value--attribute");if(t.length){var n={message:null,overlayCSS:{background:"#fff",opacity:.6,borderRadius:"4px"}};t.each(function(){var t=e(this),a=t.closest(".os_row"),o=a.find(".os_value--attribute select.multiselect");t.find("select.prl_attribute_selector").val();t.on("change","select.prl_attribute_selector",function(){var t={action:"woocommerce_prl_json_get_attribute_terms",taxonomy:e(this).val(),security:wc_prl_admin_params.attributes_form_nonce};a.block(n),e.ajax({url:wc_prl_admin_params.wc_ajax_url,data:t,method:"GET",dataType:"json",success:function(e){o.children().remove(),o.selectSW({data:e}),a.unblock()},error:function(){alert(wc_prl_admin_params.i18n_attributes_form_session_expired),a.unblock()}})}).on("click",".os_value--tools .select_all",function(){var t=e(this).closest(".os_value");return t.find("select.multiselect option").prop("selected","selected"),t.find("select.multiselect").trigger("change"),!1}).on("click",".os_value--tools .select_none",function(){var t=e(this).closest(".os_value");return t.find("select.multiselect option").removeAttr("selected"),t.find("select.multiselect").trigger("change"),!1})})}},a.prototype={reset_options:function(){this.$list.html(""),this.$data_container.attr("data-filters_count",0),this.options_count=0,this.maybe_add_boarding()},get_os_row_template:function(e){var t=!1;if(e=e.toLowerCase(),"function"==typeof this.os_row_templates[e])t=this.os_row_templates[e];else{var n=this.templates.row;n=n.replace("%%type%%",e),t=wp.template(n),this.os_row_templates[e]=t}return t},get_os_add_template:function(e){var t=!1;if(e=e.toLowerCase(),"function"==typeof this.os_add_templates[e])t=this.os_add_templates[e];else{var n=this.templates.add;n=n.replace("%%type%%",e),t=wp.template(n),this.os_add_templates[e]=t}return t},get_os_row_content_template:function(e,t){var n=!1;if(e=e.toLowerCase(),"object"==typeof this.os_row_content_templates[e]&&"function"==typeof this.os_row_content_templates[e][t])n=this.os_row_content_templates[e][t];else{var a=this.templates.row_content;a=(a=a.replace("%%type%%",e)).replace("%%os_id%%",t),n=wp.template(a),void 0===this.os_row_content_templates[e]&&(this.os_row_content_templates[e]={}),this.os_row_content_templates[e][t]=n}return n},maybe_add_boarding:function(){0==this.options_count?(this.$list.addClass("hidden"),this.$boarding.addClass("active"),this.$add_container.addClass("os_add--boarding")):(this.$list.removeClass("hidden"),this.$boarding.removeClass("active"),this.$add_container.removeClass("os_add--boarding"))}},e(function(){try{e(n.body).on("sw-select2-init",function(){e(".wc-engine-search").filter(":not(.enhanced)").each(function(){var n=e(this),a=n.closest(".sw-form-content").find("input.locations_type_select"),o=n.closest(".sw-form").find("#os-list"),i={allowClear:!!n.data("allow_clear"),placeholder:n.data("placeholder"),minimumInputLength:n.data("minimum_input_length")?n.data("minimum_input_length"):"3",escapeMarkup:function(e){return e},ajax:{url:wc_prl_admin_params.wc_ajax_url,dataType:"json",delay:250,data:function(e){return{term:e.term,action:n.data("action")||"woocommerce_prl_json_search_engines",security:wc_prl_admin_params.search_engine_nonce,exclude:n.data("exclude"),filter_type:n.data("filter_type"),include:n.data("include"),limit:n.data("limit"),display_stock:n.data("display_stock")}},processResults:function(t){var n=[];return t&&e.each(t,function(e,t){n.push({id:e,text:t.text,engine_type:t.type})}),{results:n}},cache:!0}};n.selectSW(i).addClass("enhanced").on("select2:selecting",function(n){if(a.length)return!(n.params.args.data.engine_type!==a.val()&&e.trim(o.html())&&!t.confirm(wc_prl_admin_params.i18n_change_type_conditions_warning))&&void 0}).on("select2:select",function(e){if(a.length){var t=e.params.data;t.engine_type!==a.val()&&a.val(t.engine_type).trigger("change")}})})}).trigger("sw-select2-init")}catch(e){t.console.log(e)}e("body.post-type-prl_engine.edit-php").length&&(e(".button-disabled").on("click",function(e){e.preventDefault(),e.stopPropagation()}),e(".wc-action-button-regenerate:not(.button-disabled)").on("click",function(n){n.preventDefault();var a=e(this),o={action:"woocommerce_prl_regenerate_engine",engine_id:parseInt(a.attr("id"),10),security:wc_prl_admin_params.regenerate_engine_nonce};e.ajax({url:wc_prl_admin_params.wc_ajax_url,data:o,method:"POST",dataType:"json",complete:function(){},success:function(e){e.errors.length>0?t.alert(e.errors.join("\n\n")):t.alert(wc_prl_admin_params.i18n_engine_regeneration)},error:function(){t.alert(wc_prl_admin_params.i18n_toggle_session_expired)}})}));var o,i;if(e("#wc-prl-engine-data").length){var r,s,l={};o=e("#prl_engine_type");var c=e(".wc-prl-filters-container");i={row:"wc_prl_engine_%%type%%_filter_row",add:"wc_prl_engine_%%type%%_filter_add_content",row_content:"wc_prl_engine_%%type%%_filter_%%os_id%%_content"},l.filters=new a(o,c,i);var _=e(".wc-prl-amplifiers-container");i={row:"wc_prl_engine_%%type%%_amplifier_row",add:"wc_prl_engine_%%type%%_amplifier_add_content",row_content:"wc_prl_engine_%%type%%_amplifier_%%os_id%%_content"},l.amplifiers=new a(o,_,i),l.amplifiers.$data_container.sw_enhanced_weight(),l.amplifiers.$data_container.maybe_disable_weight_selector(),l.amplifiers.$data_container.on("os_remove os_added os_changed",function(){e(this).maybe_disable_weight_selector()});var d=o.val(),p=e(".engine_type_assistant"),m=!!p.length&&p.find(".engine_type_assistant__locations span");m&&m.length&&m.each(function(){var t=e(this);-1!==t.data("engine_type").indexOf(d)?t.fadeIn("fast"):t.hide()}),o.on("change",function(){var n=e(this).val();if(d===n)return!1;s=!0;for(r in l)if(e.trim(l[r].$list.html())){t.confirm(wc_prl_admin_params.i18n_change_type_warning)||(e(this).val(d),s=!1);break}if(s){d=n;for(r in l)l[r].$data_container.trigger("change_type");m&&m.length&&m.each(function(){var t=e(this);-1!==t.data("engine_type").indexOf(n)?t.fadeIn("fast"):t.hide()})}})}var f=e("#wc-prl-deploy-data");if(f.length){new a(o=e("#prl_engine_type"),e(".wc-prl-conditions-container"),i={row:"wc_prl_engine_%%type%%_condition_row",add:"wc_prl_engine_%%type%%_condition_add_content",row_content:"wc_prl_engine_%%type%%_condition_%%os_id%%_content"}),f.find("#sw-button-primary").on("click",function(){var t=e(this);return setTimeout(function(){t.attr("disabled","true")},0),!0})}var u=e(".quick-deploy__search");if(u.length){var h=u.data("action");u.find("select").change(function(){var n=parseInt(e(this).val(),10);h=h.replace("%%engine_id%%",n),t.location=h})}e("#deployments-table").length&&(e(".wc-action-button.delete, .row-actions .delete").on("click",function(e){if(!t.confirm(wc_prl_admin_params.i18n_delete_deployment_warning))return e.preventDefault(),!1}),e(".wc-action-button-regenerate, .row-actions .regenerate a").on("click",function(n){n.preventDefault();var a=e(this),o={action:"woocommerce_prl_regenerate_deployment",engine_id:parseInt(a.attr("id"),10),security:wc_prl_admin_params.regenerate_deployment_nonce};e.ajax({url:wc_prl_admin_params.wc_ajax_url,data:o,method:"POST",dataType:"json",complete:function(){},success:function(e){e.errors.length>0?t.alert(e.errors.join("\n\n")):t.alert(wc_prl_admin_params.i18n_deployment_regeneration)},error:function(){t.alert(wc_prl_admin_params.i18n_toggle_session_expired)}})}));var g=e(".wc-prl-deployments");if(g.length){var w=e(".wc-metaboxes"),v=g.find(".toolbar"),y=g.find(".wc-prl-deployments__list__buttons"),b=g.find(".wc-prl-deployments__boarding"),x=v.find(".bulk_toggle_wrapper"),$=e(".wc-prl-hooks .wc-prl-hooks__tab--active .current_count"),C={row:"wc_prl_engine_%%type%%_condition_row",add:"wc_prl_engine_%%type%%_condition_add_content",row_content:"wc_prl_engine_%%type%%_condition_%%os_id%%_content"};w.find(".wc-metabox").each(function(){var t=e(this),n=t.find(".locations_type_select"),o=t.find(".wc-prl-conditions-container");n.on("change",function(){o.trigger("change_type")}),new a(n,o,C)}),v.on("click",".expand_all",function(){return w.find(".wc-metabox").each(function(){var t=e(this);t.find(".wc-metabox-content").show(),t.addClass("open").removeClass("closed")}),!1}).on("click",".close_all",function(){return w.find(".wc-metabox").each(function(){var t=e(this);t.find(".wc-metabox-content").hide(),t.addClass("closed").removeClass("open")}),!1}),g.on("click",".wc-metabox > h3",function(t){if("active-toggle"===t.target.id||"remove_row"===t.target.id)return!1;var n=e(this);n.parent(".wc-metabox").toggleClass("closed").toggleClass("open"),n.next(".wc-metabox-content").stop().slideToggle(300)}).on("click","#remove_row",function(n){var a=e(this).closest(".wc-prl-deployments__row");if(!a.hasClass("wc-prl-deployments__row--added")&&!t.confirm(wc_prl_admin_params.i18n_delete_deployment_warning))return n.preventDefault(),!1;var o=a.data("deployment_id"),i={message:null,overlayCSS:{background:"#fff",opacity:.6}};w.block(i);var r={action:"wc_prl_delete_deployment",deployment_id:o,security:wc_prl_admin_params.delete_deployment_nonce};e.ajax({url:wc_prl_admin_params.wc_ajax_url,data:r,method:"POST",dataType:"json",complete:function(){w.unblock()},success:function(e){e.errors.length>0?t.alert(e.errors.join("\n\n")):(a.remove(),k(),j(!1),$last_deployment=w.find(".wc-prl-deployments__row").last(),$last_deployment.length||(b.removeClass("wc-prl-deployments__boarding--hidden"),y.addClass("wc-prl-deployments__list__buttons--empty")))},error:function(){t.alert(wc_prl_admin_params.i18n_toggle_session_expired)}})}).on("click","#active-toggle",function(){var n=e(this),a=n.closest(".wc-metabox").find(".wc-metabox-content > input.form_active"),o=n.closest(".wc-prl-deployments__row"),i=o.data("deployment_id");if(o[0].className.indexOf("wc-prl-deployments__row--added")>-1)return T(n,a),!1;n.addClass("woocommerce-input-toggle--loading");var r={action:"wc_prl_toggle_deployment",value:a.val(),deployment_id:i,security:wc_prl_admin_params.toggle_deployment_nonce};return e.ajax({url:wc_prl_admin_params.wc_ajax_url,data:r,method:"POST",dataType:"json",complete:function(){n.removeClass("woocommerce-input-toggle--loading")},success:function(e){e.errors.length>0?t.alert(e.errors.join("\n\n")):T(n,a)},error:function(){t.alert(wc_prl_admin_params.i18n_toggle_session_expired)}}),!1}).on("click","button.wc-prl-deployments__add",function(n){n.preventDefault();var o,i,r=w.data("filter_type"),s=w.find(".wc-prl-deployments__row").last();s.length?(o=parseInt(s.find("input.form_index").val(),10)+1,i=parseInt(s.attr("data-index"),10)):(o=0,i=0);var l={message:null,overlayCSS:{background:"#fff",opacity:.6}};w.block(l);var c={action:"wc_prl_add_deployment",form_index:o,index:i,filter_type:r,security:wc_prl_admin_params.add_deployment_nonce};e.ajax({url:wc_prl_admin_params.wc_ajax_url,data:c,method:"POST",dataType:"json",complete:function(){w.unblock()},success:function(n){if(n.errors.length>0)t.alert(n.errors.join("\n\n"));else{var o=e(n.markup);b.hasClass("wc-prl-deployments__boarding--hidden")||(b.addClass("wc-prl-deployments__boarding--hidden"),y.removeClass("wc-prl-deployments__list__buttons--empty")),w.append(o),o.prl_scripts();var i=o.find(".locations_type_select"),r=o.find(".wc-prl-conditions-container");o.find(".wc-engine-search").one("change",function(){o.find(".sw-form").removeClass("sw-form--no-engine")}),i.on("change",function(){r.trigger("change_type")}),new a(i,r,C),j(!0)}},error:function(){t.alert(wc_prl_admin_params.i18n_toggle_session_expired)}})}),w.on("keyup","input.form_deployment_title",function(){var t=e(this);t.closest(".wc-metabox").find("h3 .deployment_title_inner").text(t.val())}),w.sortable({items:".wc-prl-deployments__row",cursor:"move",axis:"y",handle:".sort-item",scrollSensitivity:40,forcePlaceholderSize:!0,helper:"clone",opacity:.65,placeholder:"wc-metabox-sortable-placeholder",start:function(e,t){t.item.css("background-color","#f6f6f6")},stop:function(e,t){t.item.removeAttr("style"),k()}});var k=function(){w.find(".wc-prl-deployments__row").each(function(t,n){var a=t+1;e(n).attr("data-index",a),e(".form_display_order",n).val(a),e(".deployment_title_index",n).html(a)})},j=function(e){var t=parseInt($.html(),10);!0===e?t++:t--,t>0?x.removeClass("disabled"):x.addClass("disabled"),$.html(t)},T=function(e,t){"on"===t.val()?(t.val("off"),e.removeClass("woocommerce-input-toggle--enabled").addClass("woocommerce-input-toggle--disabled")):(t.val("on"),e.removeClass("woocommerce-input-toggle--disabled").addClass("woocommerce-input-toggle--enabled"))}}})}(jQuery,window,document);