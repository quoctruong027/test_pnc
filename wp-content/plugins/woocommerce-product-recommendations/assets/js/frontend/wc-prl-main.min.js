!function(t,e){WC_PRL=e.WC_PRL||{},WC_PRL.$window=t(e),WC_PRL.params=e.wc_prl_params,WC_PRL.cookies=WC_PRL.cookies||{},WC_PRL.cookies.model=function(){function t(t,e,r){var n,o;void 0===r&&(r=i),(n=new Date).setTime(n.getTime()+r),o="expires="+n.toUTCString(),document.cookie=t+"="+e+"; "+o+"; path=/"}function e(t){var e,i=t+"=",r=decodeURIComponent(document.cookie).split(";");for(e=0;e<r.length;e++){for(var n=r[e];" "===n.charAt(0);)n=n.substring(1);if(0===n.indexOf(i))return n.substring(i.length,n.length)}return""}var i=1e3*WC_PRL.params.shopping_session_seconds;return{set:t,get:e,remove:function(t){document.cookie=t+"=; expires=Thu, Jan 01 1970 00:00:00 UTC;path=/"},refresh:function(i){t(i,e(i))}}}(),WC_PRL.cookies.views=function(t){function e(){return this instanceof e?i||(i=this,this.cookie_raw="",void(this.viewed_ids=[])):new e}var i;return e.prototype.init=function(){this.cookie_raw=t.get("wc_prl_deployments_viewed"),""!==this.cookie_raw&&(this.viewed_ids=this.cookie_raw.split(","),t.set("wc_prl_deployments_viewed",this.viewed_ids.join(",")))},e.prototype.is_viewed=function(t){return-1!==this.viewed_ids.indexOf(t)},e.prototype.add_deployment=function(e){-1===this.viewed_ids.indexOf(e)&&(this.viewed_ids.length>WC_PRL.params.views_max_cookie_num-1&&this.viewed_ids.splice(0,1),this.viewed_ids.push(e),t.set("wc_prl_deployments_viewed",this.viewed_ids.join(",")))},e}(WC_PRL.cookies.model),WC_PRL.cookies.recently_viewed=function(e){function i(){return this instanceof i?r||(r=this,this.cookie_raw="",this.viewed_ids=[],this.viewed_cat_ids=[],void(this.viewed_tag_ids=[])):new i}var r,n=WC_PRL.params.recently_views_max_cookie_num;return i.prototype.init=function(){if(this.cookie_raw=e.get("wc_prl_recently_viewed"),""!==this.cookie_raw){var i=this.cookie_raw.split(",");i.length&&(this.viewed_ids=t.map(i[0].split("|"),function(t){return parseInt(t,10)}),i.length>1&&(this.viewed_cat_ids=t.map(i[1].split("|"),function(t){return parseInt(t,10)})),i.length>2&&(this.viewed_tag_ids=t.map(i[2].split("|"),function(t){return parseInt(t,10)}))),this.save()}},i.prototype.add_product_id=function(t){this.viewed_ids.length>n&&this.viewed_ids.shift(),t=parseInt(t,10);var e=this.viewed_ids.indexOf(t);e>-1&&this.viewed_ids.splice(e,1),this.viewed_ids.push(t)},i.prototype.add_category_id=function(t){this.viewed_cat_ids.length>n&&this.viewed_cat_ids.shift(),t=parseInt(t,10);var e=this.viewed_cat_ids.indexOf(t);e>-1&&this.viewed_cat_ids.splice(e,1),this.viewed_cat_ids.push(t)},i.prototype.add_tag_id=function(t){this.viewed_tag_ids.length>n&&this.viewed_tag_ids.shift(),t=parseInt(t,10);var e=this.viewed_tag_ids.indexOf(t);e>-1&&this.viewed_tag_ids.splice(e,1),this.viewed_tag_ids.push(t)},i.prototype.save=function(){var t=this.viewed_ids.join("|"),i=this.viewed_cat_ids.join("|"),r=this.viewed_tag_ids.join("|");this.cookie_raw=t,i&&(this.cookie_raw+=","+i),r&&(this.cookie_raw+=","+r),e.set("wc_prl_recently_viewed",this.cookie_raw)},i}(WC_PRL.cookies.model),WC_PRL.storage=function(){function t(t){e?localStorage.removeItem(t):i.remove(t)}var e=!1,i=WC_PRL.cookies.model;return localStorage&&(e=!0),{set:function(r,n){void 0!==n&&null!==n?("object"==typeof n&&(n=JSON.stringify(n)),e?localStorage.setItem(r,n):i.set(r,n,2147483647)):t(r)},get:function(t){var r;r=e?localStorage.getItem(t):i.get(t);try{r=JSON.parse(r)}catch(t){r=r}return r},remove:t}}(),WC_PRL.utilities=WC_PRL.utilities||{},WC_PRL.utilities.throttle=function(t,e){var i=Date.now();return function(){i+e-Date.now()<0&&(t(),i=Date.now())}},WC_PRL.utilities.url=function(){return{handle_tracking:function(t){var e=t.split("#"),i=e[0].split("?"),r="";if(i.length>=2){var n,o=i.shift(),s=i.join("?").split(/[&;]/g);for(n=s.length;n--;)-1!==s[n].lastIndexOf("prl_track=",0)&&(r=s[n].split("=").pop(),s.splice(n,1));t=o+(s.length>0?"?"+s.join("&"):""),e[1]&&(t+="#"+e[1])}return{url:t,tracking:r}}}}(),WC_PRL.utilities.timer=function(){function t(e,i,r){if(!(this instanceof t))return new t(e,i,r);this.deployment=e,this.is_running=!1,this.interval=null,this.interval_ms=r,this.time=1,this.time_limit=i}return t.prototype.start=function(){this.is_running||(this.interval=setInterval(function(){this.time=this.time+1,this.time>=this.time_limit&&!this.deployment.is_viewed&&(this.stop(),this.deployment.viewed())}.bind(this),this.interval_ms),this.is_running=!0)},t.prototype.stop=function(){clearTimeout(this.interval),this.is_running=!1,this.interval=null,this.time=1},t}(),WC_PRL.utilities.tracking=function(){function i(t,e,i,r){var n=WC_PRL.$window,o=n.width(),a=n.height(),_=t.getBoundingClientRect(),l=_.top>=0&&_.top+c<a,d=_.bottom>s&&_.bottom<=a,h=_.top<0&&_.bottom>a,u=_.left>=0&&_.left<o,p=_.right>0&&_.right<=o,v=e?l||d||h:l&&d,f=e?u||p:u&&p;return"both"===r?i&&v&&f:"vertical"===r?i&&v:"horizontal"===r?i&&f:void 0}function r(t,e,i,r){var n=WC_PRL.$window,o=n.width(),a=n.height(),_=n.scrollTop()+c,l=_+a-c-s,d=n.scrollLeft(),h=d+o,u=t.offset(),p=u.top,v=p+t.height(),f=u.left,g=f+t.width(),w=!0===e?v:p,m=!0===e?p:v,y=!0===e?g:f,k=!0===e?f:g;return"both"===r?!!i&&m<=l&&w>=_&&k<=h&&y>=d:"vertical"===r?!!i&&m<=l&&w>=_:"horizontal"===r?!!i&&k<=h&&y>=d:void 0}var n=WC_PRL.params,o=WC_PRL.storage,s=200,c=200,a="function"==typeof Element.prototype.getBoundingClientRect;return{is_in_viewport:function(t,e,n,o){var _=t.get(0),l=!0!==n||_.offsetWidth*_.offsetHeight;return!e&&(s>0||c>0)&&(e=!0),o=o||"vertical",a?i(_,e,l,o):r(t,e,l,o)},store_click:function(t){var e=o.get("wc_prl_click_tracking");e?e+=",":e="",o.set("wc_prl_click_tracking",e+t)},log_clicks:function(){var i=o.get("wc_prl_click_tracking");if(i){var r=i.split(",");if(r.length){var s,c,a,_={clicks:[],security:n.security_click_event_nonce},l=WC_PRL.cookies.model.get("wc_prl_deployments_clicked");l=l.split(",");for(s in r)a=(c=r[s].split("_"))[0]+"_"+c[3],5===c.length&&(a+="_"+c[4]),Array.isArray(l)&&-1===l.indexOf(a)&&-1===_.clicks.indexOf(r[s])&&_.clicks.push(r[s]);_.clicks.length&&t.post(woocommerce_params.wc_ajax_url.toString().replace("%%endpoint%%","woocommerce_prl_log_click_event"),_,function(t){"failure"!==t.result?o.remove("wc_prl_click_tracking"):e.console.error("PRL Click Tracking Error: ",t)})}}}}}(),WC_PRL.controllers=WC_PRL.controllers||{},WC_PRL.controllers.Deployment=function(){function i(t){if(!(this instanceof i))return new i(t);this.id=null,this.engine_id=null,this.location_hash=null,this.source_hash=null,this.is_viewed=!1,this.xhr=!1,this.ajax_url=woocommerce_params.wc_ajax_url,this.timer=o(this,r.deployment_interest_time,1e3),this.$deployment=t}var r=WC_PRL.params,n=WC_PRL.utilities.tracking.is_in_viewport||null,o=WC_PRL.utilities.timer||null,s=new WC_PRL.cookies.views;return i.prototype.get_id=function(){if(!this.id){var t=this.$deployment.attr("id"),e=/([0-9]+)$/g,i=parseInt(t.match(e),10);this.id=i}return this.id},i.prototype.get_engine_id=function(){if(!this.engine_id){var t=parseInt(this.$deployment.data("engine"),10);this.engine_id=t}return this.engine_id},i.prototype.get_location_hash=function(){if(!this.location_hash){var t=this.$deployment.data("location-hash");this.location_hash=t}return this.location_hash},i.prototype.get_source_hash=function(){if(!this.source_hash){var t=this.$deployment.data("source-hash");this.source_hash=t}return this.source_hash},i.prototype.get_ajax_url=function(t){return this.ajax_url.toString().replace("%%endpoint%%",t)},i.prototype.viewed=function(){this.is_viewed=!0,this.timer=null,"yes"===r.script_debug&&this.$deployment.css("background","green"),this.add_view_event()},i.prototype.add_view_event=function(){var i=this.get_id(),n=this.get_engine_id(),o=this.get_location_hash(),c=this.get_source_hash();if(i){var a=c?i+"_"+c:i;s.add_deployment(a),"yes"===r.script_debug&&e.console.info("PRL Recording View Event: ",a),this.xhr&&this.xhr.abort();var _={id:i,engine_id:n,location_hash:o,source_hash:c,security:r.security_view_event_nonce};this.xhr=t.post(this.get_ajax_url("woocommerce_prl_log_view_event"),_,function(t){"failure"===t.result?e.console.error("PRL View Tracking Error: ",t):"yes"===r.script_debug&&e.console.info("PRL Recorded View Event.")})}},i.prototype.do_viewport_tracking=function(){this.is_viewed||this.$deployment&&(n(this.$deployment,!0,!1,"vertical")?("yes"===r.script_debug&&this.$deployment.css("background","red"),this.timer.start()):(this.timer.stop(),"yes"===r.script_debug&&this.$deployment.css("background","transparent")))},i}(),WC_PRL.update_product_history=function(){var i=WC_PRL.cookies.recently_viewed();return function(){if(t("body.single-product").length){var r,n=t("form.cart").first().find('[name="add-to-cart"]'),o=parseInt(n.val(),10);if(!o)return void e.console.warn("Could not parse the product id. Tracking bypassed...");var s=t(".product#product-"+o);if(s.length){i.init();var c=s.attr("class"),a=/wc-prl-cat-([0-9-]+)\s?/g,_=c.match(a);if(_&&_ instanceof Array){var l=_.pop().replace("wc-prl-cat-","").trim().split("-");for(r in l)i.add_category_id(l[r])}var d=/wc-prl-tag-([0-9-]+)\s?/g,h=c.match(d);if(h&&h instanceof Array){var u=h.pop().replace("wc-prl-tag-","").trim().split("-");for(r in u)i.add_tag_id(u[r])}i.add_product_id(o),i.save()}}}}(),WC_PRL.deployments=function(){var i=new WC_PRL.cookies.views,r=WC_PRL.utilities.tracking.store_click||null,n=WC_PRL.$window;return{track:function(o,s){if("no"!==WC_PRL.params.tracking_enabled&&(o=o||t(".wc-prl-recommendations:not(.placeholder)")).length){s="true"===s;var c=WC_PRL.controllers.Deployment,a=WC_PRL.utilities.throttle,_=WC_PRL.utilities.url.handle_tracking,l=t(document.body).hasClass("woocommerce-checkout");o.each(function(){var o=t(this),d=c(o),h=d.get_source_hash()?d.get_id()+"_"+d.get_source_hash():d.get_id();i.is_viewed(String(h))||(d.do_viewport_tracking(),n.scroll(a(d.do_viewport_tracking.bind(d),200))),s&&o.on("click","a",function(i){i.preventDefault();var n=t(this).attr("href");if(n){var o=_(n);r(o.tracking),-1!==n.indexOf("add-to-cart")&&"yes"===WC_PRL.params.ajax_add_to_cart||(e.location.href=o.url)}}),l&&o.on("click","a.add_to_cart_button",function(e){t(document.body).one("added_to_cart",function(){t(document.body).trigger("update_checkout")})})})}},render:function(i){if((i=i||t(".wc-prl-ajax-placeholder")).length){var r=function(){var e=[];return i.each(function(){var i=t(this).attr("id");e.push(i)}),e}(),o=function(){var e;return i.each(function(){var i;i=t(this).attr("data-env");try{e=JSON.parse(i)}catch(i){e=!1}if(e)return!1}),e}(),s={locations:r.join(","),product:o.product?o.product:"",archive:o.archive?o.archive:"",order:o.order?o.order:"",current_url:e.location.href};n.trigger("wc_prl_deployments_before_render"),t.post(woocommerce_params.wc_ajax_url.toString().replace("%%endpoint%%","woocommerce_prl_print_location"),s,function(r){"failure"===r.result&&e.console.error("PRL Deployment Render Error: ",r);var o;for(o in r.html)r.html[o]&&i.each(function(){var e=t(this);if(o==e.attr("id"))return e.replaceWith(r.html[o]),!1});n.trigger("wc_prl_deployments_after_render"),WC_PRL.deployments.track(null,"true")})}}}}();var i=WC_PRL.cookies.model.refresh;"yes"===WC_PRL.params.tracking_enabled&&(WC_PRL.cookies.views().init(),WC_PRL.utilities.tracking.log_clicks(),i("wc_prl_deployments_clicked")),i("wc_prl_recently_viewed"),t(function(){WC_PRL.update_product_history();var e=t(".wc-prl-ajax-placeholder");e.length?WC_PRL.deployments.render(e):WC_PRL.deployments.track()})}(jQuery,window);