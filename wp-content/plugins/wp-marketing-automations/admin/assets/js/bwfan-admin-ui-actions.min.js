"use strict";var BWFAN_Actions,bwfan_select2_ajax_data=window.bwfan_set_select2ajax_js_data;!function(t){(BWFAN_Actions={init:function(){this.dom_ready(),this.win_load(),this.dom_click()},dom_ready:function(){t(document).ready(function(){t(document).on("bwfan_trigger_modified",function(){t("#bwfan-source-events").html(""),!0===_.isUndefined(BWFAN_Auto.uiDataDetail.trigger.event)?BWFAN_Actions.create_event_ui(!0):BWFAN_Actions.create_event_ui(!1)}),t(document).on("bwfan_action_modified",function(t,a,e){BWFAN_Auto.emptySidebar(),BWFAN_Actions.build_right_ui(a,e);var n=bwfanParams.events_merge_tags;n=n[BWFAN_Auto.uiDataDetail.trigger.event],BWFAN_Actions.make_merge_tag_ui(BWFAN_Auto.uiDataDetail.trigger.event,n)}),t(document).on("submit","#bwfan-events-form-container",function(a){if(!1===BWFAN_Auto.is_event_exists())return swal({title:window.bwfan.texts.sync_oops_title,text:window.bwfan.texts.no_event,type:"error"}),void a.preventDefault();var e=!1,n=[],i=[];for(var o in t(".bwfan-checkbox").each(function(){var a=t(this).attr("name"),e=t(this).attr("data-warning");n.push(a),i.push(e)}),t.unique(n),t.unique(i),n)if(0==t('[name="'+n[o]+'"]:checked').length)return swal({type:"error",title:window.bwfan.texts.sync_oops_title,text:i[o]}),e=!0,!1;if(e)return console.log("checkbox not checked"),!1;var s=t(this).bwfan_serializeAndEncode();s=bwfan_deserialize_obj(s),BWFAN_Auto.setTriggerData("",s);var r=bwfan_automation_data.all_triggers_events,c=BWFAN_Auto.uiDataDetail.trigger.source,l=BWFAN_Auto.uiDataDetail.trigger.event,d=BWFAN_Actions.get_action_name("event_text",c,l);if(BWFAN_Auto.setTriggerData("name",d),bwfan_automation_data.is_time_independent=r[c][l].is_time_independent,_.size(BWFAN_Auto.uiData)<2){BWFAN_Auto.uiData[0].html=["gap"],BWFAN_Auto.uiData.push({id:"else",mode:"0",html:["end_html"]});var u=wp.template("bwfan-sidebar-top"),f=BWFAN_Auto.getSidebarTopTextArr("select_block");BWFAN_Auto.rightElemTop.html(u(f))}return t('.item_wrap[data-group-id="'+s.bwfan_group_id+'"] .bwfan-select-action[data-group-id="'+s.bwfan_action_id+'"]').attr("data-filled",1),BWFAN_Auto.buildAutomation(),t(document).trigger("bwfan_automation_save"),!1}),t(document).on("submit","#bwfan-actions-form-container",function(){var a=t(this).bwfan_serializeAndEncode(),e=(a=bwfan_deserialize_obj(a)).bwfan[a.bwfan_action_id],n=e.integration_slug,i=e.action_slug,o=BWFAN_Actions.get_action_name("action_text",n,i),s="";_.has(e,"time")&&_.has(e.time,"delay_type")&&"immediately"!==e.time.delay_type&&(s='<i class="dashicons dashicons-clock"></i>');var r='<div class="bwfan_small_name">'+o.integration+"</div>"+s+o.action+"</div>",c=BWFAN_Actions.get_action_name("action",n,i);BWFAN_Actions.get_action_name("integration",n,i);e.action_name=o;var l=BWFAN_Auto.getActionData(a.bwfan_group_id,a.bwfan_action_id);return _.has(l,"ajax-data")&&(e["ajax-data"]=l["ajax-data"]),c&&(t('.workflow_item[data-group="'+a.bwfan_group_id+'"] .item_modify_action[data-action="'+a.bwfan_action_id+'"] .action_text').html(r),t('.workflow_item[data-group="'+a.bwfan_group_id+'"] .item_modify_action[data-action="'+a.bwfan_action_id+'"] .bwfan_hide_hard').removeClass("bwfan_hide_hard")),BWFAN_Auto.setActionData(a.bwfan_group_id,a.bwfan_action_id,e),t('.item_wrap[data-group-id="'+a.bwfan_group_id+'"] .bwfan-select-action[data-group-id="'+a.bwfan_action_id+'"]').attr("data-filled",1),t(document).trigger("bwfan_automation_save"),!1}),t(document).on("bwfan_automation_save",function(a){if(!0!==_.isUndefined(BWFAN_Auto)){if(!1===BWFAN_Auto.is_event_exists())return swal({title:window.bwfan.texts.sync_oops_title,text:window.bwfan.texts.no_event,type:"error"}),void a.preventDefault();if("on"==bwfan_automation_data.automation_sync_state)return swal({title:window.bwfan.texts.sync_oops_title,text:window.bwfan.texts.sync_process_oops_title,type:"error"}),void a.preventDefault();if(!0===_.isUndefined(BWFAN_Auto.uiDataDetail.trigger.name))return swal({type:"error",title:window.bwfan.texts.sync_oops_title,text:window.bwfan.texts.no_trigger}),!1;var e=t(".bwfan-manage-automation-form"),n=t(e).serializeArray(),i=!1;t(n).each(function(t,a){var e=a.value;if(null!=e&&"-1"==a.name.indexOf("ajax_data")){if(0==(i=BWFAN_Actions.validate_merge_tags_syntax(e)))return i=!0,!1;i=!1}});var o=!1,s=[],r=[];for(var c in t(".bwfan-checkbox").each(function(){var a=t(this).attr("name"),e=t(this).attr("data-warning");s.push(a),r.push(e)}),t.unique(s),t.unique(r),s)if(0==t('[name="'+s[c]+'"]:checked').length)return swal({type:"error",title:window.bwfan.texts.sync_oops_title,text:r[c]}),o=!0,!1;if(o)return console.log("checkbox not checked"),!1;i?swal({type:"error",title:window.bwfan.texts.merge_tag_error_title,text:window.bwfan.texts.merge_tag_error_text}):e[0].checkValidity()?e.trigger("submit"):e.find(":submit").click()}});var a=new bwf_ajax(".bwfan-manage-automation-form",!0);a.data=function(t){return t.append("data",JSON.stringify(BWFAN_Auto.uiDataDetail)),t.append("ui",JSON.stringify(BWFAN_Auto.ui)),t.append("uiData",JSON.stringify(BWFAN_Auto.uiData)),t},a.success=function(e){var n=a.element(),i=t(n);if(1==e.status){var o=t("#modal_automation_success");o.length>0&&(o.iziModal("setTitle",e.msg),o.iziModal("open")),i.find("input[name=t_to_delete]").val("")}else swal({type:"error",title:window.bwfan.texts.sync_oops_title,text:e.msg})},t(document).on("change",".bwfan-selected-source",function(){var a=t(this).val();t("#bwfan-source-events").html(""),""===a&&(BWFAN_Auto.setBlankUI(),BWFAN_Auto.setBlankUIDetail());var e=bwfan_automation_data.all_sources_events[a];e=e.events;var n=!1;!1===_.has(BWFAN_Auto.uiDataDetail.trigger,"source")&&(n=!0),!1!==_.has(BWFAN_Auto.uiDataDetail.trigger,"source")&&a!=BWFAN_Auto.uiDataDetail.trigger.source?swal({title:"",text:window.bwfan.texts.source_change,type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, proceed.",cancelButtonText:"No, Revert.",allowOutsideClick:!1}).then(function(n){n&&(console.log("yes"),BWFAN_Auto.setBlankData(),BWFAN_Auto.emptySidebar(),BWFAN_Auto.uiData.push({id:"trigger",html:{}}),BWFAN_Auto.buildAutomation(),t(document).trigger("bwfan_trigger_modified"),BWFAN_Actions.set_source_val(a),BWFAN_Actions.bwfan_set_events_new(!0,e))}).catch(function(){console.log("no"),t(".bwfan-selected-source").val(BWFAN_Auto.uiDataDetail.trigger.source),BWFAN_Actions.create_event_ui(!1)}):BWFAN_Actions.bwfan_set_events_new(n,e)}),t(document).on("keyup",".search_merge_tag",function(){var a=t(this).val();t(".bwfan-table-merge-tags tr").each(function(){var e=t(this),n=e.find("td:first").text(),i=new RegExp(a,"g");n.match(i)?e.show():e.hide()})}),t(document).on("change",".bwfan-selected-trigger",function(){var a=t(this),e=a.val(),n=a.attr("data-old");if(""===e)return BWFAN_Auto.setup_cancelled_elements(a,{selected_value:e,old_value:n,events_merge_tags:i}),BWFAN_Auto.show_prompt_before_delete(window.bwfan.texts.change_event_title,window.bwfan.texts.change_event_text,"bwfan_modify_event","Yes! delete all actions","Do nothing"),t("#bwfan-section-merge-tags").html('<h3 class="bwfan-text-center">Please Select An Event</h3>'),void t(".bwfan-events-meta").html("");var i=bwfanParams.events_merge_tags;if(i=i[e],!1===_.isUndefined(BWFAN_Auto.uiDataDetail.trigger.event)&&BWFAN_Auto.uiDataDetail.trigger.event!=e)return BWFAN_Auto.setup_cancelled_elements(a,{selected_value:e,old_value:n,events_merge_tags:i}),BWFAN_Auto.show_prompt_before_delete(window.bwfan.texts.change_event_title,window.bwfan.texts.change_event_text,"bwfan_modify_event","Yes! delete all actions","Do nothing"),!1;BWFAN_Actions.make_merge_tag_ui(e,i),t("#tmpl-event-"+e).length>0?BWFAN_Actions.create_event_meta_ui(e):t(".bwfan-events-meta").html("")}),t(document).on("focus",".bwfan-selected-trigger",function(){var a=t(this),e=a.val();""!==e&&a.attr("data-old",e)}),t(document).on("change","select.bwfan-selected-action",function(){var a=t(this),e=a.val(),n=BWFAN_Actions.get_group_action_id_action_ui(a,"group_id"),i=BWFAN_Actions.get_group_action_id_action_ui(a,"action_id"),o=a.parents("#bwfan-actions-form");if(o.attr("data-action","n"),_.isEmpty(e)){BWFAN_Auto.setActionFieldData(n,i,"temp_action_slug",e);try{t('.workflow_item[data-group="'+n+'"]').find('.item_modify_action[data-action="'+i+'"]').trigger("click"),o.attr("data-action","y")}catch(a){t(".bwfan-fields-"+i).html("")}}else{o.attr("data-action","y");var s=window.bwfan_automation_data.int_actions[e];t('input[name="bwfan['+i+'][integration_slug]"]').val(s);var r=BWFAN_Actions.get_action_name("action_text",s,e),c='<div class="bwfan_small_name">'+r.integration+"</div>"+r.action+"</div>";t('.workflow_item[data-group="'+n+'"] .item_modify_action[data-action="'+i+'"] .action_text').html(c);var l=BWFAN_Auto.getActionData(n,i);if(_.isUndefined(l.temp_action_slug))return BWFAN_Auto.setActionFieldData(n,i,"temp_action_slug",e),void BWFAN_Actions.build_action_ui(n,i);l.temp_action_slug!==e&&(BWFAN_Auto.setActionFieldData(n,i,"temp_action_slug",e),BWFAN_Actions.build_action_ui(n,i))}}),t(document).on("change",".bwfan-delay-types",function(){var a=t(this);BWFAN_Actions.create_execution_delay_time_ui(a),t(".bwfan-delay-options-container").hide(),"immediately"===a.val()||t(".bwfan_time_"+a.val()).show()}),t(document).on("change","#scheduled_time_check",function(){var a=t(this);t("#scheduled_time_check:checked").length?a.parent().siblings("div").removeClass("bwfan-display-none"):a.parent().siblings("div").addClass("bwfan-display-none")}),t(document).on("change","#scheduled_days_check",function(){var a=t(this);t("#scheduled_days_check:checked").length?a.parent().siblings("div").removeClass("bwfan-display-none"):a.parent().siblings("div").addClass("bwfan-display-none")}),t(document).on("change",".bwfan_time_number",function(){var a=t(this);BWFAN_Actions.create_execution_delay_time_ui(a)}),t(document).on("change",".bwfan-delay-mode",function(){var a=t(this);BWFAN_Actions.create_execution_delay_time_ui(a)}),t(document).on("keyup change paste","#bwfan-actions-form-container input, #bwfan-actions-form-container select, #bwfan-actions-form-container textarea",function(){var a=t("#bwfan-actions-form-container").bwfan_serializeAndEncode();a=bwfan_deserialize_obj(a);var e=parseInt(a.bwfan_group_id),n=parseInt(a.bwfan_action_id),i=a.bwfan[n],o=i.integration_slug,_=i.action_slug,s=BWFAN_Actions.get_action_name("action_text",o,_);i.action_name=s,BWFAN_Auto.setActionData(e,n,i)})})},win_load:function(){t(window).bind("load",function(){var a;if("undefined"!=typeof BWFAN_Auto&&!1===_.isUndefined(BWFAN_Auto.uiDataDetail.trigger)&&(a=(a=bwfanParams.events_merge_tags)[BWFAN_Auto.uiDataDetail.trigger.event],BWFAN_Actions.make_merge_tag_ui(BWFAN_Auto.uiDataDetail.trigger.event,a)),t(".bwfan-selected-trigger").length>0){var e=t(".bwfan-selected-trigger").val();""!==e&&(a=(a=bwfanParams.events_merge_tags)[e],BWFAN_Actions.make_merge_tag_ui(e,a))}})},dom_click:function(){var a="";t(document).on("click",".bwfan-selected-merge-tag",function(){var e=t("#modal-show-merge-tags h2.iziModal-header-title");a=e.text();var n=t(this).attr("data-class"),i="#tmpl-"+t(this).attr("data-class"),o=t(i).attr("data-tag");e.html('<span class="dashicons dashicons-arrow-left-alt bwfan_back_merge_tags" title="Back"></span>'+o),t(".bwfan-merge-tag-list").hide();var _=wp.template(n);if(bwfan_make_html(1,"#bwfan-merge-tag-settings",_()),t(".bwfan-preview-merge-tag").val("{{"+o+"}}"),t(".bwfan_inner_merge_tag_desc").html(t(".desc_"+n).html()),t("#bwfan-merge-tag-settings").attr("merge-tag",o),t(".bwfan-select2ajax-single").length>0){var s=t(".bwfan-select2ajax-single").attr("data-search"),r=t(".bwfan-select2ajax-single").attr("data-search-text");BWFAN_Actions.initiate_select2_ajax_single(".bwfan-select2ajax-single",r,s)}t("body").trigger("bwfan-selected-merge-tag",{tag:o})}),t(document).on("click",".bwfan_back_merge_tags",function(){t("#bwfan-merge-tag-settings").html("");var e=t("#modal-show-merge-tags h2.iziModal-header-title");e.text(a),e.css("padding-left","0px"),t(".bwfan-merge-tag-list").show()}),t(document).on("change",".bwfan_tag_select",function(){BWFAN_Actions.create_merge_tag_code()}),t(document).on("change","#add_recovery_url_coupon",function(){"yes"===t(this).val()?t(this).closest(".bwfan_mtag_wrap").siblings(".bwfan_mtag_wrap").show():t(this).closest(".bwfan_mtag_wrap").siblings(".bwfan_mtag_wrap").hide()}),t(document).on("change","#recovery_url_coupon",function(){var a=t("#bwfan-merge-tag-settings").attr("merge-tag")+" ";a="{{"+a+("coupon='"+t(this).val()+"'")+"}}",t(".bwfan-preview-merge-tag").val(a)}),t(document).on("change",".bwfan_tag_input",function(){t(this).hasClass("recovery_url_coupon")||BWFAN_Actions.create_merge_tag_code()}),t(document).on("click",".bwfan-open-merge-tags-modal",function(){t(".bwfan-merge-tag-list").show(),t("#bwfan-merge-tag-settings").html("")}),t(document).on("click",".bwfan-use-merge-tag",function(){var a=t(".bwfan_form_merge_tags");if(!a[0].checkValidity())return a.find(":submit").click(),!1;var e=t(this).siblings(".bwfan-preview-merge-tag")[0];BWFAN_Actions.copy_merge_tag_code(e),t("#modal-show-merge-tags").iziModal("close")}),t(document).on("click",".bwfan_preview_email",function(){var a=t("#bwfan-actions-form-container").bwfan_serializeAndEncode();a=bwfan_deserialize_obj(a);var e=t(".bwfan-selected-action").attr("data-group-id"),n=a.bwfan[e];n.source=BWFAN_Auto.uiDataDetail.trigger.source,n.event=BWFAN_Auto.uiDataDetail.trigger.event,n._wpnonce=bwfanParams.ajax_nonce,n.automation_id=bwfan_automation_data.automation_id;var i=new bwf_ajax;i.ajax("show_email_preview",n),i.success=function(t){!0===t.status&&window.open(bwfanParams.admin_url+"admin.php?page=autonami&section=preview_email&type=loaded&edit="+bwfan_automation_data.automation_id,"preview_email","location=yes,height=800,width=800,scrollbars=yes,status=yes")}}),t(document).on("click","#bwfan_test_email_btn",function(){var a=t("#bwfan_test_email");if(""!==a.val()){var e=t(this);e.prop("disabled",!0),a.prop("disabled",!0);var n=a.val(),i=t("#bwfan-actions-form-container").bwfan_serializeAndEncode();i=bwfan_deserialize_obj(i);var o=t(".bwfan-selected-action").attr("data-group-id"),_=i.bwfan[o];_.source=BWFAN_Auto.uiDataDetail.trigger.source,_.event=BWFAN_Auto.uiDataDetail.trigger.event,_._wpnonce=bwfanParams.ajax_nonce,_.automation_id=bwfan_automation_data.automation_id,_.email=n;var s=new bwf_ajax;s.ajax("test_email",_),s.success=function(n){if(e.prop("disabled",!1),a.prop("disabled",!1),1==n.status){var i=t("#modal_automation_success");i.length>0&&(i.iziModal("setTitle",n.msg),i.iziModal("open"))}else swal({type:"error",title:window.bwfan.texts.sync_oops_title,text:n.msg})}}else a.addClass("bwfan_field_input_error")}),t(document).on("keyup","#bwfan_test_email",function(){var a=t(this);""===a.val()?a.addClass("bwfan_field_input_error"):a.hasClass("bwfan_field_input_error")&&a.removeClass("bwfan_field_input_error")}),t(document).on("click",".bwfan-show-timer-options",function(){t(this).parent().siblings(".bwfan-timer-options-container").slideToggle()}),t("body").on("click","span.bwfan-remove-repeater-field",function(a){a.preventDefault(),t(this).closest(".gs-repeater-fields").remove()}),t("body").on("click",".bwfan-repeater-ui",function(a){a.preventDefault();var e=t(this),n=Number(e.attr("data-count")),i=e.attr("data-groupid"),o=e.attr("data-repeater-slug"),_=wp.template("action-repeater-ui-"+o);try{e.parents(".bwfan-repeater-wrap").find(".bwfan-input-repeater").append(_({action_id:i,index:n,actionFieldsOptions:{}})),n+=1,e.attr("data-count",n)}catch(t){console.log("action-repeater-ui-"+o+" template not found")}})},create_event_ui:function(a){if(0!=t("#bwfan_events_output_div").length){var e=bwfan_automation_data.all_triggers,n=wp.template("bwfan-events-form-container");bwfan_make_html(1,".wr .wr_wrap_form",n);var i=wp.template("single-source");if(bwfan_make_html(1,"#bwfan-events-form",i({sources:e})),!0===a){if(Object.keys(e).length>0){var o=Object.keys(e);t(".bwfan-selected-source").val(o[0]),t(".bwfan-selected-source").trigger("change")}}else t(".bwfan-selected-source").val(BWFAN_Auto.uiDataDetail.trigger.source),t(".bwfan-selected-source").trigger("change")}},create_event_meta_ui:function(a){var e=wp.template("event-"+a);t(".bwfan-events-meta").html("");var n=bwfan_events_js_data[a];if(bwfan_make_html(1,".bwfan-events-meta",e({eventSavedData:BWFAN_Auto.uiDataDetail.trigger.event_meta,eventFieldsOptions:n})),t(".bwfan-select2ajax").length>0){var i=t(".bwfan-select2ajax").attr("data-search"),o=t(".bwfan-select2ajax").attr("data-search-text");BWFAN_Actions.initiate_select2_ajax(".bwfan-select2ajax",o,i)}if(t(".bwfan-tags").length>0&&this.initiate_select2(".bwfan-tags","Select",!0),t(".bwfan-single-select").length>0&&this.initiate_select2(".bwfan-single-select","Select",!1),t("#bwfan-editor").length>0){this.initiate_wysiwyg_editor("bwfan-editor")}},build_right_ui:function(a,e){var n=wp.template("bwfan-actions-form-container");bwfan_make_html(1,".wr .wr_wrap_form",n);var i=this.filter_events_actions(),o=BWFAN_Auto.getActionData(a,e),s="",r="";Object.keys(o).length>0&&(_.has(o,"integration_slug")&&!_.isEmpty(o.integration_slug)&&(s=o.integration_slug),_.has(o,"action_slug")&&!_.isEmpty(o.action_slug)&&(r=o.action_slug),_.isEmpty(r)&&_.has(o,"temp_action_slug")&&!_.isEmpty(o.temp_action_slug)&&(r=o.temp_action_slug)),_.isEmpty(s)&&!_.isEmpty(r)&&(s=window.bwfan_automation_data.int_actions[r]),_.isEmpty(r)?t("#bwfan-actions-form").attr("data-action","n"):t("#bwfan-actions-form").attr("data-action","y");var c=BWFAN_Auto.getSidebarTopTextArr("select_action");if(!1===_.isUndefined(BWFAN_Auto.uiDataDetail.actions[a])&&!1===_.isUndefined(BWFAN_Auto.uiDataDetail.actions[a][e])&&!1===_.isUndefined(BWFAN_Auto.uiDataDetail.actions[a][e].action_name)){var l=BWFAN_Auto.getActionDesc(s,r);c={head:BWFAN_Auto.uiDataDetail.actions[a][e].action_name,desc:l}}BWFAN_Auto.setSidebarTopText(c);var d=wp.template("single-action");bwfan_make_html(1,"#bwfan-actions-form",d({action_id:e,integration_slug:s,action_slug:r,all_actions:i})),BWFAN_Actions.build_action_ui(a,e,!1),t("#bwfan_group_id").val(a),t("#bwfan_action_id").val(e),t(".bwfan-action-submit-button").show()},filter_events_actions:function(){var a,e,n,i,o=window.bwfan_automation_data.actions_int,_=bwfan_automation_data.all_integrations,s=BWFAN_Auto.uiDataDetail.trigger.event,r=[],c=[];for(var l in _)for(n in e=_[l]){var d=e[n];if(d.included_events.length){var u=d.included_events;-1===t.inArray(s,u)&&r.push(n)}else{var f=d.excluded_events;-1!==t.inArray(s,f)&&r.push(n)}}if(bwfan_events_included_actions[s].length)for(a=0;a<bwfan_events_included_actions[s].length;a++)c.push(bwfan_events_included_actions[s][a]);else if(bwfan_events_excluded_actions[s].length)for(a=0;a<bwfan_events_excluded_actions[s].length;a++)r.push(bwfan_events_excluded_actions[s][a]);if(o=JSON.stringify(o),o=JSON.parse(o),t.isArray(c)&&c.length>0)for(i in o)if(o.hasOwnProperty(i)){for(n in e=o[i])-1===t.inArray(n,c)&&delete o[i][n];e=o[i],0===Object.keys(e).length&&delete o[i]}if(t.isArray(r)&&r.length>0)for(i in o)if(o.hasOwnProperty(i)){for(n in e=o[i])-1!==t.inArray(n,r)&&delete o[i][n];e=o[i],0===Object.keys(e).length&&delete o[i]}if(Object.keys(bwfan_automation_data.pro_actions).length>0){var g=bwfan_automation_data.pro_actions;for(var w in g){var m=g[w];if(Object.keys(m).length>0)for(var b in!1===o.hasOwnProperty(w)&&(o[w]={}),m)o[w][b]={label:m[b],available:"no"}}}return o},get_action_name:function(t,a,e){var n="";if(""===a||""===e)return n;if("action"===t||"integration"===t||"action_text"===t){var i=bwfan_automation_data.all_integrations,o=bwfan_automation_data.all_automations,_=i[a][e].action_name,s=o[a].nice_name;"action_text"===t?n={integration:s,action:_}:"action"===t?n=_:"integration"===t&&(n=s)}else if("event"===t||"source"===t||"event_text"===t){var r=bwfan_automation_data.all_triggers,c=bwfan_automation_data.all_triggers_events,l=r[a].nice_name,d=c[a][e].event_name;"event_text"===t?n={integration:l,action:d}:"event"===t?n=d:"source"===t&&(n=l)}return n},get_event_desc:function(t,a){var e="";if(""===t||""===a)return e;var n=bwfan_automation_data.all_triggers_events;return!1===_.has(n,t)||!1===_.has(n[t],a)||!1===_.has(n[t][a],"event_desc")?e:e=n[t][a].event_desc},bwfan_set_events_new:function(a,e){if(t("#bwfan_events_output_div").length>0){var n;if(1!=a){var i=t(".bwfan-selected-source").val(),o=BWFAN_Auto.uiDataDetail.trigger.source,_=BWFAN_Auto.uiDataDetail.trigger.event;return n=wp.template("single-event"),bwfan_make_html(1,"#bwfan-source-events",n({action_id:0,triggers_events:e})),i!=o?t(".bwfan-selected-trigger").val(""):t(".bwfan-selected-trigger").val(_),void t(".bwfan-selected-trigger").trigger("change")}n=wp.template("single-event"),bwfan_make_html(1,"#bwfan-source-events",n({action_id:0,triggers_events:e}))}},make_event_meta:function(){},build_action_ui:function(a,e,n){var i=BWFAN_Auto.getActionData(a,e);if(_.isUndefined(n)&&(n=!0),0!=_.size(_.keys(i))){var o,s="";if(_.isUndefined(i.action_slug)){if(_.isUndefined(i.temp_action_slug))return;s=i.temp_action_slug}else s=i.action_slug,!1===n&&(BWFAN_Auto.setActionFieldData(a,e,"temp_action_slug",null),i.temp_action_slug=null),!0!==n||_.isUndefined(i.temp_action_slug)||i.action_slug==i.temp_action_slug||(s=i.temp_action_slug);if(!_.isEmpty(s)){var r;if(t(".bwfan-form-inner .bwfan-show-merge-tags").css("display","block"),o=bwfan_set_actions_js_data[s],!(t("#tmpl-action-"+s).length>0))return r=wp.template("bwfan-no-action-found"),bwfan_make_html(1,".bwfan-fields-"+e,r()),void t("#bwfan-actions-form").attr("data-pro","n");if(r=wp.template("action-"+s),bwfan_make_html(1,".bwfan-fields-"+e,r({group_id:a,action_id:e,actionSavedData:i,actionFieldsOptions:o})),t("#bwfan-actions-form").removeAttr("data-pro"),t(".bwfan_add_tags_final_value").length>0&&t(".bwfan_add_tags_final_value").each(function(){var a=t(this),e=t(this).parents(".bwfan_add_tags").find(".tagchecklist"),n=a.attr("data-name"),o=_.has(i.data,n)?i.data[n]:[],c=_.has(bwfan_set_actions_js_data,s)?bwfan_set_actions_js_data[s].tags_options:[];_.size(o)>0&&(r=wp.template("bwfan-tags-cancel-ui"),e.html(r({tags:o,tagNames:c})),r=wp.template("bwfan-tags-select-html"),a.html(r({tags:o})))}),1==bwfan_automation_data.enable_lang){var c=bwfan_automation_data.all_triggers_events,l=BWFAN_Auto.uiDataDetail.trigger.source,d=BWFAN_Auto.uiDataDetail.trigger.event;if(!0===c[l][d].support_lang){r=wp.template("lang-support");var u={};void 0!==i.language&&(u=i.language),bwfan_make_html(1,".bwfan-lang-support-container",r({group_id:a,action_id:e,lang_options:bwfan_automation_data.lang_options,language:u}))}}r=wp.template("single-timer");var f={};void 0!==i.time&&(f=i.time),bwfan_make_html(1,".bwfan-timer-"+e,r({group_id:a,action_id:e,timerData:f})),r=wp.template("timer-display"),bwfan_make_html(1,".bwfan-time-container",r({group_id:a,action_id:e,timerData:f}));var g={};void 0!==i.action_priority&&(g={priority:i.action_priority});var w=wp.template("action-priority");if(bwfan_make_html(1,".bwfan-priority-"+e,w({group_id:a,action_id:e,priorityData:g})),t(".bwfan-select2ajax-single").length>0){var m=t(".bwfan-select2ajax-single").attr("data-search"),b=t(".bwfan-select2ajax-single").attr("data-search-text");this.initiate_select2_ajax_single(".bwfan-select2ajax-single",b,m)}if(t(".bwfan-tags").length>0&&this.initiate_select2(".bwfan-tags","Select",!0),t(".bwfan-single-select").length>0&&this.initiate_select2(".bwfan-single-select","Select",!1),t(".bwfan-tags-multiple").length>0&&this.initiate_select2_multiple(".bwfan-tags-multiple","Select",!1),t(".bwfan-datepicker").length>0&&this.initiate_datepicker(".bwfan-datepicker"),t("#bwfan-editor").length>0){this.initiate_wysiwyg_editor("bwfan-editor")}t(".bwfan_add_tags").length>0&&this.initiate_add_tag_ui(".bwfan_add_tags"),t("#bwfan_lang_support").length>0&&t("#bwfan_lang_support").on("click",function(){t(".bwfan_lang_support").toggleClass("bwfan-display-none")}),t(document).trigger("bwfan_after_action_ui_build",[a,e,i,o,f])}}},set_source_val:function(a){_.isUndefined(a)||_.isEmpty(a)||0!=t(".bwfan-selected-source").length&&t(".bwfan-selected-source").val(a)},create_merge_tag_code:function(){var a=t("#bwfan-merge-tag-settings").attr("merge-tag"),e="",n=t(".bwfan_form_merge_tags").bwfan_serializeAndEncode();for(var i in n=bwfan_deserialize_obj(n))""!==n[i]&&(e=e+" "+i+"='"+n[i]+"'");a="{{"+a+e+"}}",t(".bwfan-preview-merge-tag").val(a)},copy_merge_tag_code:function(a){var e,n,i,o="INPUT"===a.tagName||"TEXTAREA"===a.tagName;o?(i=a,e=a.selectionStart,n=a.selectionEnd):((i=document.getElementById("_hiddenCopyText_"))||((i=document.createElement("textarea")).style.position="absolute",i.style.left="-9999px",i.style.top="0",i.id="_hiddenCopyText_",document.body.appendChild(i)),i.textContent=a.textContent);var _,s=document.activeElement;i.focus(),i.setSelectionRange(0,i.value.length);try{_=document.execCommand("copy");var r=t("#modal_automation_success");r.length>0&&(r.iziModal("setTitle","Merge Tag Copied"),r.iziModal("open"))}catch(t){_=!1}return s&&"function"==typeof s.focus&&s.focus(),o?a.setSelectionRange(e,n):i.textContent="",_},initiate_wysiwyg_editor:function(a){wp.editor.remove(a),wp.editor.initialize(a,{tinymce:{resize:!1,wpautop:!1,plugins:"charmap colorpicker compat3x directionality fullscreen hr image lists media paste tabfocus textcolor wordpress wpautoresize wpdialogs wpeditimage wpemoji wpgallery wplink wptextpattern wpview",toolbar1:"formatselect bold italic | bullist numlist | blockquote | alignleft aligncenter alignright | link unlink | wp_more | spellchecker | bwfan_merge_tags_button",height:400,setup:function(a){a.on("change",function(){tinymce.triggerSave()}),a.addButton("bwfan_merge_tags_button",{text:"Merge Tags {{}}",onclick:function(){t(".bwfan-open-merge-tags-modal").trigger("click")}})}},quicktags:!0,mediaButtons:!0})},initiate_add_tag_ui:function(a){t(a).on("click",".bwfan-tag-add",function(e){e.preventDefault();var n=t(this),i=n.parents(".bwfan_add_tags"),o=n.siblings("#new-tag-bwfan_tag").val();if(!_.isEmpty(o)){console.log("added tag "+o),n.siblings("#new-tag-bwfan_tag").val("");var s=i.find(".bwfan_add_tags_final_value").attr("data-action"),r=_.has(bwfan_set_actions_js_data,s)?bwfan_set_actions_js_data[s].tags_options:[],c=i.find(".bwfan_add_tags_final_value").val();if(c=_.size(c)>0?c:[],"-1"==_.indexOf(c,o)){"-1"!=_.indexOf(_.values(r),o)&&(o=_.findKey(r,function(t){return t==o})),c=_.union(c,[o]);var l=wp.template("bwfan-tags-select-html");t(a).find(".bwfan_add_tags_final_value").html(l({tags:c})),l=wp.template("bwfan-tags-cancel-ui"),t(a).find(".tagchecklist").html(l({tags:c,tagNames:r}))}}});var e,n=[];t.each(tags_options_clone,function(t,a){e={key:t,value:a},n.push(e)}),t("#new-tag-bwfan_tag").autocomplete({minLength:0,source:n,focus:function(){return t("#new-tag-bwfan_tag").val(""),!1},select:function(e,n){var i=t(a).find(".bwfan_add_tags_final_value").val();(i=_.size(i)>0?i:[]).push(n.item.key),i=_.uniq(i);var o=wp.template("bwfan-tags-select-html");t(a).find(".bwfan_add_tags_final_value").html(o({tags:i})),o=wp.template("bwfan-tags-cancel-ui");var s=t(a).find(".bwfan_add_tags_final_value").attr("data-action"),r=_.has(bwfan_set_actions_js_data,s)?bwfan_set_actions_js_data[s].tags_options:[];return t(a).find(".tagchecklist").html(o({tags:i,tagNames:r})),!1}}),t(a).on("click",".ntdelbutton",function(){var e=t(this).parents("li").attr("data-key"),n=t(a).find(".bwfan_add_tags_final_value").val(),i=_.without(n,e),o=wp.template("bwfan-tags-select-html");t(a).find(".bwfan_add_tags_final_value").html(o({tags:i})),o=wp.template("bwfan-tags-cancel-ui");var s=t(a).find(".bwfan_add_tags_final_value").attr("data-action"),r=_.has(bwfan_set_actions_js_data,s)?bwfan_set_actions_js_data[s].tags_options:[];t(a).find(".tagchecklist").html(o({tags:i,tagNames:r}))})},initiate_select2:function(a,e,n){var i={placeholder:e,tags:n,createTag:function(t){return{id:t.term,text:t.term,tag:!0}},select:function(t){console.log(t)}};t(a).select2(i)},initiate_select2_multiple:function(a,e,n){var i={placeholder:e,multiple:!0,tags:n,select:function(t){console.log(t)}};t(a).select2(i)},initiate_datepicker:function(a){t(a).datepicker({dateFormat:"yy-mm-dd"})},initiate_select2_ajax:function(a,e,n,i){var o="";try{""!=t(a).parents("tr.bwfan-rule").find("select.rule_type").val()&&(o=t(a).parents("tr.bwfan-rule").find("select.rule_type").val())}catch(t){}var _={placeholder:e,minimumInputLength:2,multiple:!0,tags:!1,data:void 0!==bwfan_select2_ajax_data[n]?this.convert_array_to_obj(bwfan_select2_ajax_data[n]):[],escapeMarkup:function(t){return t},ajax:{url:ajaxurl,dataType:"json",type:"POST",delay:250,data:function(t){return{search_term:t,action:"bwf_select2ajax",type:n,ruletype:o,_wpnonce:bwfanParams.ajax_nonce}},processResults:function(e){return BWFAN_Actions.fill_select2_ajax_data(n,e),t(document).trigger("select2ajaxdataRecieved",[a,n,e]),{results:e.results}}}};void 0!==i?t(a).select2(_).val(i).trigger("change"):t(a).select2(_)},initiate_select2_ajax_single:function(a,e,n,i){var o="";try{""!=t(a).parents("tr.bwfan-rule").find("select.rule_type").val()&&(o=t(a).parents("tr.bwfan-rule").find("select.rule_type").val())}catch(t){}var s={placeholder:e,minimumInputLength:2,tags:!1,data:void 0!==bwfan_select2_ajax_data[n]?this.convert_array_to_obj(bwfan_select2_ajax_data[n]):[],escapeMarkup:function(t){return t},ajax:{url:ajaxurl,dataType:"json",type:"POST",delay:250,data:function(t){return{search_term:t,action:"bwf_select2ajax",type:n,ruletype:o,_wpnonce:bwfanParams.ajax_nonce}},processResults:function(e){return t(document).trigger("select2ajaxdataRecieved",[a,n,e]),BWFAN_Actions.fill_select2_ajax_data(n,e),t(a).trigger("change"),{results:e.results}}},templateSelection:function(t){return _.has(bwfan_select2_ajax_data,"coupon")&&_.has(bwfan_select2_ajax_data.coupon,t.id)?bwfan_select2_ajax_data.coupon[t.id]:t.text}};void 0!==i?t(a).select2(s).val(i).trigger("change"):t(a).select2(s)},fill_select2_ajax_data:function(a,e){!1===_.isUndefined(BWFAN_Auto.uiDataDetail.trigger.event)?!0===_.isUndefined(bwfan_select2_ajax_data[a])?bwfan_select2_ajax_data[a]={}:"string"==typeof bwfan_select2_ajax_data[a]&&(bwfan_select2_ajax_data[a]=JSON.parse(bwfan_select2_ajax_data[a])):!1===_.isUndefined(bwfan_select2_ajax_data[a])?(t.isEmptyObject(bwfan_select2_ajax_data[a])||"[]"==bwfan_select2_ajax_data[a])&&(bwfan_select2_ajax_data[a]={}):bwfan_select2_ajax_data[a]={},t.map(e,function(e){t(e).each(function(t,e){bwfan_select2_ajax_data[a][e.id]=e.text})})},make_merge_tag_ui:function(a,e){var n={};if(0!==t("#bwfan-section-merge-tags").length&&(t.each(e,function(t,a){n[t]=a}),!_.isEmpty(n))){var i=wp.template("section-merge-tags");t("#bwfan-section-merge-tags").html(""),bwfan_make_html(1,"#bwfan-section-merge-tags",i({merge_tags:n}))}},create_execution_delay_time_ui:function(t){var a=t.parents("form"),e=a.find("input#bwfan_action_id").val(),n=a.find("#bwfan_delay_types_"+e).val(),i=a.find("#bwfan_time_number_"+e).val(),o=a.find("#bwfan_delay_mode_"+e).val(),_=wp.template("timer-display");bwfan_make_html(1,".bwfan-time-container",_({action_id:e,timerData:{delay_type:n,time_number:i,time_type:o}}))},validate_merge_tags_syntax:function(t){var a=!0;if("-1"==t.indexOf("{{")&&"-1"==t.indexOf("}}"))return a;var e=t.match(/{{/gi),n=t.match(/}}/gi);return null!=e&&null!=n&&((e=e.length)!==(n=n.length)&&(a=!1),a)},validate_checkboxes:function(a){var e=!1,n=[],i=[];for(var o in t(a).each(function(){var a=t(this).attr("name"),e=t(this).attr("data-warning");n.push(a),i.push(e)}),t.unique(n),t.unique(i),n)if(0==t('[name="'+n[o]+'"]:checked').length)return swal({type:"error",title:window.bwfan.texts.sync_oops_title,text:i[o]}),e=!0,!1;return!e||(console.log("checkbox not checked"),!1)},get_group_action_id_action_ui:function(t,a){if(0==t.parents("#bwfan-actions-form-container").length)return"";var e=t.parents("#bwfan-actions-form-container"),n=e.find("#bwfan_group_id").val(),i=e.find("#bwfan_action_id").val();return"group_id"==a?n:"action_id"==a?i:void 0},recreate_action_ui_ajax:function(a,e,n){var i=this.get_group_action_id_action_ui(a,"group_id"),o=this.get_group_action_id_action_ui(a,"action_id");Object.keys(e).length>0&&t.each(e,function(t,a){""!=t&&BWFAN_Auto.setActionFieldInnerData(i,o,t,a)}),Object.keys(n).length>0&&t.each(n,function(t,a){""!=t&&BWFAN_Auto.setActionFieldAjaxData(i,o,t,a)}),BWFAN_Actions.build_action_ui(i,o,!1)},convert_array_to_obj:function(t){var a=[];for(var e in t)a.push({id:e,text:t[e]});return a},make_automation_track_id:function(){var a=t(".bwfan-manage-automation-form").find("input[name=a_track_id]").val();a=_.isEmpty(a)?0:parseInt(a),a+=1,t(".bwfan-manage-automation-form").find("input[name=a_track_id]").val(a)}}).init(),t.fn.bwfan_serializeAndEncode=function(){return t.map(this.serializeArray(),function(t){return[t.name,encodeURIComponent(t.value)].join("=")}).join("&")}}(jQuery);