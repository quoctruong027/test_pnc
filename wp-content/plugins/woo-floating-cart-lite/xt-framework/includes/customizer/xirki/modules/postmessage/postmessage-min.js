var xirkiPostMessage={fields:{},styleTag:{add:function(id){if(null===document.getElementById("xirki-postmessage-"+id)||"undefined"===typeof document.getElementById("xirki-postmessage-"+id)){jQuery("head").append('<style id="xirki-postmessage-'+id+'"></style>')}},addData:function(id,styles){xirkiPostMessage.styleTag.add(id);jQuery("#xirki-postmessage-"+id).text(styles)}},util:{processValue:function(output,value){var self=this,settings=window.parent.wp.customize.get(),excluded=false;if("object"===typeof value){_.each(value,function(subValue,key){value[key]=self.processValue(output,subValue)});return value}output=_.defaults(output,{prefix:"",units:"",suffix:"",value_pattern:"$",pattern_replace:{},exclude:[]});if(1<=output.exclude.length){_.each(output.exclude,function(exclusion){if(value==exclusion){excluded=true}})}if(excluded){return false}value=output.value_pattern.replace(new RegExp("\\$","g"),value);_.each(output.pattern_replace,function(id,placeholder){if(!_.isUndefined(settings[id])){value=value.replace(placeholder,settings[id])}});return output.prefix+value+output.units+output.suffix},backgroundImageValue:function(url){return-1===url.indexOf("url(")?"url("+url+")":url}},css:{fromOutput:function(output,value,controlType){var styles="",xirkiParent=window.parent.xirki,googleFont="",mediaQuery=false,processedValue;if(output.js_callback&&"function"===typeof window[output.js_callback]){value=window[output.js_callback[0]](value,output.js_callback[1])}switch(controlType){case"xirki-typography":styles+=output.element+"{";_.each(value,function(val,key){if(output.choice&&key!==output.choice){return}processedValue=xirkiPostMessage.util.processValue(output,val);if(false!==processedValue){styles+=key+":"+processedValue+";"}});styles+="}";if(!_.isUndefined(WebFont)&&value["font-family"]&&"google"===xirkiParent.util.webfonts.getFontType(value["font-family"])){googleFont=value["font-family"].replace(/\"/g,"&quot;");if(value.variant){if("regular"===value.variant){googleFont+=":400"}else if("italic"===value.variant){googleFont+=":400i"}else{googleFont+=":"+value.variant}}googleFont+=":cyrillic,cyrillic-ext,devanagari,greek,greek-ext,khmer,latin,latin-ext,vietnamese,hebrew,arabic,bengali,gujarati,tamil,telugu,thai";WebFont.load({google:{families:[googleFont]}})}break;case"xirki-background":case"xirki-dimensions":case"xirki-multicolor":case"xirki-sortable":styles+=output.element+"{";_.each(value,function(val,key){if(output.choice&&key!==output.choice){return}if("background-image"===key){val=xirkiPostMessage.util.backgroundImageValue(val)}processedValue=xirkiPostMessage.util.processValue(output,val);if(false!==processedValue){if(output.property){styles+=output.property;if(""!==output.property&&("top"===key||"bottom"===key||"left"===key||"right"===key)){styles+="-"+key}styles+=":"+processedValue+";"}else{styles+=key+":"+processedValue+";"}}});styles+="}";break;default:if("xirki-image"===controlType){value=!_.isUndefined(value.url)?xirkiPostMessage.util.backgroundImageValue(value.url):xirkiPostMessage.util.backgroundImageValue(value)}if(_.isObject(value)){styles+=output.element+"{";_.each(value,function(val,key){if(output.choice&&key!==output.choice){return}processedValue=xirkiPostMessage.util.processValue(output,val);if(!output.property){output.property=key}if(false!==processedValue){styles+=output.property+":"+processedValue+";"}});styles+="}"}else{processedValue=xirkiPostMessage.util.processValue(output,value);if(false!==processedValue){styles+=output.element+"{"+output.property+":"+processedValue+";}"}}break}if(output.media_query&&"string"===typeof output.media_query&&!_.isEmpty(output.media_query)){mediaQuery=output.media_query;if(-1===mediaQuery.indexOf("@media")){mediaQuery="@media "+mediaQuery}}if(mediaQuery){return mediaQuery+"{"+styles+"}"}return styles}},html:{fromOutput:function(output,value){if(output.js_callback&&"function"===typeof window[output.js_callback]){value=window[output.js_callback[0]](value,output.js_callback[1])}if(_.isObject(value)||_.isArray(value)){if(!output.choice){return}_.each(value,function(val,key){if(output.choice&&key!==output.choice){return}value=val})}value=xirkiPostMessage.util.processValue(output,value);if(output.attr){jQuery(output.element).attr(output.attr,value)}else{jQuery(output.element).html(value)}}},toggleClass:{fromOutput:function(output,value){if("undefined"===typeof output.class||"undefined"===typeof output.value){return}if(value===output.value&&!jQuery(output.element).hasClass(output.class)){jQuery(output.element).addClass(output.class)}else{jQuery(output.element).removeClass(output.class)}}}};jQuery(document).ready(function(){_.each(xirkiPostMessageFields,function(field){wp.customize(field.settings,function(value){value.bind(function(newVal){var styles="";_.each(field.js_vars,function(output){if(!output.function||"undefined"===typeof xirkiPostMessage[output.function]){output.function="css"}if("css"===output.function){styles+=xirkiPostMessage.css.fromOutput(output,newVal,field.type)}else{xirkiPostMessage[output.function].fromOutput(output,newVal,field.type)}});xirkiPostMessage.styleTag.addData(field.settings,styles)})})})});