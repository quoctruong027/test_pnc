goog.provide("webfont.DomHelper");webfont.DomHelper=function(mainWindow,opt_loadWindow){this.mainWindow_=mainWindow;this.loadWindow_=opt_loadWindow||mainWindow;this.protocol_;this.document_=this.loadWindow_.document};goog.scope(function(){var DomHelper=webfont.DomHelper;DomHelper.CAN_WAIT_STYLESHEET=!!window["FontFace"];DomHelper.prototype.createElement=function(elem,opt_attr,opt_innerHtml){var domElement=this.document_.createElement(elem);if(opt_attr){for(var attr in opt_attr){if(opt_attr.hasOwnProperty(attr)){if(attr=="style"){this.setStyle(domElement,opt_attr[attr])}else{domElement.setAttribute(attr,opt_attr[attr])}}}}if(opt_innerHtml){domElement.appendChild(this.document_.createTextNode(opt_innerHtml))}return domElement};DomHelper.prototype.insertInto=function(tagName,e){var t=this.document_.getElementsByTagName(tagName)[0];if(!t){t=document.documentElement}t.insertBefore(e,t.lastChild);return true};DomHelper.prototype.whenBodyExists=function(callback){var that=this;if(that.document_.body){callback()}else{if(that.document_.addEventListener){that.document_.addEventListener("DOMContentLoaded",callback)}else{that.document_.attachEvent("onreadystatechange",function(){if(that.document_.readyState=="interactive"||that.document_.readyState=="complete"){callback()}})}}};DomHelper.prototype.removeElement=function(node){if(node.parentNode){node.parentNode.removeChild(node);return true}return false};DomHelper.prototype.appendClassName=function(e,name){this.updateClassName(e,[name])};DomHelper.prototype.removeClassName=function(e,name){this.updateClassName(e,null,[name])};DomHelper.prototype.updateClassName=function(e,opt_add,opt_remove){var add=opt_add||[],remove=opt_remove||[];var classes=e.className.split(/\s+/);for(var i=0;i<add.length;i+=1){var found=false;for(var j=0;j<classes.length;j+=1){if(add[i]===classes[j]){found=true;break}}if(!found){classes.push(add[i])}}var remainingClasses=[];for(var i=0;i<classes.length;i+=1){var found=false;for(var j=0;j<remove.length;j+=1){if(classes[i]===remove[j]){found=true;break}}if(!found){remainingClasses.push(classes[i])}}e.className=remainingClasses.join(" ").replace(/\s+/g," ").replace(/^\s+|\s+$/,"")};DomHelper.prototype.hasClassName=function(e,name){var classes=e.className.split(/\s+/);for(var i=0,len=classes.length;i<len;i++){if(classes[i]==name){return true}}return false};DomHelper.prototype.setStyle=function(e,styleString){e.style.cssText=styleString};DomHelper.prototype.getMainWindow=function(){return this.mainWindow_};DomHelper.prototype.getLoadWindow=function(){return this.loadWindow_};DomHelper.prototype.getHostName=function(){return this.getLoadWindow().location.hostname||this.getMainWindow().location.hostname};DomHelper.prototype.createStyle=function(css){var e=this.createElement("style");e.setAttribute("type","text/css");if(e.styleSheet){e.styleSheet.cssText=css}else{e.appendChild(document.createTextNode(css))}return e};DomHelper.prototype.loadStylesheet=function(href,opt_callback,opt_async){var link=this.createElement("link",{rel:"stylesheet",href:href,media:opt_async?"only x":"all"});var sheets=this.document_.styleSheets,eventFired=false,asyncResolved=!opt_async,callbackArg=null,callback=opt_callback||null;function mayInvokeCallback(){if(callback&&eventFired&&asyncResolved){callback(callbackArg);callback=null}}if(DomHelper.CAN_WAIT_STYLESHEET){link.onload=function(){eventFired=true;mayInvokeCallback()};link.onerror=function(){eventFired=true;callbackArg=new Error("Stylesheet failed to load");mayInvokeCallback()}}else{setTimeout(function(){eventFired=true;mayInvokeCallback()},0)}function onStylesheetAvailable(callback){for(var i=0;i<sheets.length;i++){if(sheets[i].href&&sheets[i].href.indexOf(href)!==-1){return callback()}}setTimeout(function(){onStylesheetAvailable(callback)},0)}function onMediaAvailable(callback){for(var i=0;i<sheets.length;i++){if(sheets[i].href&&sheets[i].href.indexOf(href)!==-1&&sheets[i].media){var media=sheets[i].media;if(media==="all"||media.mediaText&&media.mediaText==="all"){return callback()}}}setTimeout(function(){onMediaAvailable(callback)},0)}this.insertInto("head",link);if(opt_async){onStylesheetAvailable(function(){link.media="all";onMediaAvailable(function(){asyncResolved=true;mayInvokeCallback()})})}return link};DomHelper.prototype.loadScript=function(src,opt_callback,opt_timeout){var head=this.document_.getElementsByTagName("head")[0];if(head){var script=this.createElement("script",{src:src});var done=false;script.onload=script.onreadystatechange=function(){if(!done&&(!this.readyState||this.readyState=="loaded"||this.readyState=="complete")){done=true;if(opt_callback){opt_callback(null)}script.onload=script.onreadystatechange=null;if(script.parentNode.tagName=="HEAD")head.removeChild(script)}};head.appendChild(script);setTimeout(function(){if(!done){done=true;if(opt_callback){opt_callback(new Error("Script load timeout"))}}},opt_timeout||5e3);return script}return null}});