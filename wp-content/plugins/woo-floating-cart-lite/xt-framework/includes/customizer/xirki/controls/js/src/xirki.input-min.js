var xirki=xirki||{};xirki=jQuery.extend(xirki,{input:{radio:{init:function(control){var input=jQuery('input[data-id="'+control.id+'"]');input.on("change keyup paste click",function(){xirki.setting.set(control.id,jQuery(this).val())})}},color:{init:function(control){var picker=jQuery('.xirki-color-control[data-id="'+control.id+'"]'),clear;control.choices=control.choices||{};if(_.isEmpty(control.choices)&&control.params.choices){control.choices=control.params.choices}if(!_.isEmpty(control.choices)){picker.wpColorPicker(control.choices)}setTimeout(function(){clear=jQuery('.xirki-input-container[data-id="'+control.id+'"] .wp-picker-clear');if(clear.length){clear.click(function(){xirki.setting.set(control.id,"")})}},200);picker.wpColorPicker({change:function(){setTimeout(function(){xirki.setting.set(control.id,picker.val())},20)},clear:function(event){setTimeout(function(){control.saveValue("color","")},100)}})}},genericInput:{init:function(control){var input=jQuery('input[data-id="'+control.id+'"]');input.on("change keyup paste click",function(){xirki.setting.set(control.id,jQuery(this).val())})}},textarea:{init:function(control){var textarea=jQuery('textarea[data-id="'+control.id+'"]');textarea.on("change keyup paste click",function(){xirki.setting.set(control.id,jQuery(this).val())})}},select:{init:function(control){var element=jQuery('select[data-id="'+control.id+'"]'),multiple=parseInt(element.data("multiple"),10),selectValue,selectWooOptions={escapeMarkup:function(markup){return markup}};if(control.params.placeholder){selectWooOptions.placeholder=control.params.placeholder;selectWooOptions.allowClear=true}if(1<multiple){selectWooOptions.maximumSelectionLength=multiple}jQuery(element).selectWoo(selectWooOptions).on("change",function(){selectValue=jQuery(this).val();selectValue=null===selectValue&&1<multiple?[]:selectValue;xirki.setting.set(control.id,selectValue)})}},number:{init:function(control){var element=jQuery('input[data-id="'+control.id+'"]'),value=control.setting._value,up,down;control.params.choices=_.defaults(control.params.choices,{min:0,max:100,step:1});if(isNaN(value)||""===value){value=0>control.params.choices.min&&0<control.params.choices.max?0:control.params.choices.min}value=parseFloat(value);control.params.choices.step="any"===control.params.choices.step?.001:control.params.choices.step;control.params.choices.min=parseFloat(control.params.choices.min);control.params.choices.max=parseFloat(control.params.choices.max);control.params.choices.step=parseFloat(control.params.choices.step);up=jQuery('.xirki-input-container[data-id="'+control.id+'"] .plus');down=jQuery('.xirki-input-container[data-id="'+control.id+'"] .minus');up.click(function(){var oldVal=parseFloat(element.val()),newVal;newVal=oldVal>=control.params.choices.max?oldVal:oldVal+control.params.choices.step;element.val(newVal);element.trigger("change")});down.click(function(){var oldVal=parseFloat(element.val()),newVal;newVal=oldVal<=control.params.choices.min?oldVal:oldVal-control.params.choices.step;element.val(newVal);element.trigger("change")});element.on("change keyup paste click",function(){var val=jQuery(this).val();if(isNaN(val)){val=parseFloat(val,10);val=isNaN(val)?0:val;jQuery(this).attr("value",val)}xirki.setting.set(control.id,val)})}},image:{init:function(control){var value=xirki.setting.get(control.id),saveAs=!_.isUndefined(control.params.choices)&&!_.isUndefined(control.params.choices.save_as)?control.params.choices.save_as:"url",preview=control.container.find(".placeholder, .thumbnail"),previewImage="array"===saveAs?value.url:value,removeButton=control.container.find(".image-upload-remove-button"),defaultButton=control.container.find(".image-default-button");value="array"===saveAs&&_.isString(value)?{url:value}:value;if(("id"===saveAs||"ID"===saveAs)&&""!==value){wp.media.attachment(value).fetch().then(function(){setTimeout(function(){var url=wp.media.attachment(value).get("url");preview.removeClass().addClass("thumbnail thumbnail-image").html('<img src="'+url+'" alt="" />')},700)})}if("url"===saveAs&&""!==value||"array"===saveAs&&!_.isUndefined(value.url)&&""!==value.url){control.container.find("image-default-button").hide()}if("url"===saveAs&&""===value||"array"===saveAs&&(_.isUndefined(value.url)||""===value.url)){removeButton.hide()}if(value===control.params.default){control.container.find("image-default-button").hide()}if(""!==previewImage){preview.removeClass().addClass("thumbnail thumbnail-image").html('<img src="'+previewImage+'" alt="" />')}control.container.on("click",".image-upload-button",function(e){var image=wp.media({multiple:false}).open().on("select",function(){var uploadedImage=image.state().get("selection").first(),jsonImg=uploadedImage.toJSON(),previewImage=jsonImg.url;if(!_.isUndefined(jsonImg.sizes)){previewImage=jsonImg.sizes.full.url;if(!_.isUndefined(jsonImg.sizes.medium)){previewImage=jsonImg.sizes.medium.url}else if(!_.isUndefined(jsonImg.sizes.thumbnail)){previewImage=jsonImg.sizes.thumbnail.url}}if("array"===saveAs){xirki.setting.set(control.id,{id:jsonImg.id,url:jsonImg.sizes.full.url,width:jsonImg.width,height:jsonImg.height})}else if("id"===saveAs){xirki.setting.set(control.id,jsonImg.id)}else{xirki.setting.set(control.id,!_.isUndefined(jsonImg.sizes)?jsonImg.sizes.full.url:jsonImg.url)}if(preview.length){preview.removeClass().addClass("thumbnail thumbnail-image").html('<img src="'+previewImage+'" alt="" />')}if(removeButton.length){removeButton.show();defaultButton.hide()}});e.preventDefault()});control.container.on("click",".image-upload-remove-button",function(e){var preview,removeButton,defaultButton;e.preventDefault();xirki.setting.set(control.id,"");preview=control.container.find(".placeholder, .thumbnail");removeButton=control.container.find(".image-upload-remove-button");defaultButton=control.container.find(".image-default-button");if(preview.length){preview.removeClass().addClass("placeholder").html(xirkiL10n.noFileSelected)}if(removeButton.length){removeButton.hide();if(jQuery(defaultButton).hasClass("button")){defaultButton.show()}}});control.container.on("click",".image-default-button",function(e){var preview,removeButton,defaultButton;e.preventDefault();xirki.setting.set(control.id,control.params.default);preview=control.container.find(".placeholder, .thumbnail");removeButton=control.container.find(".image-upload-remove-button");defaultButton=control.container.find(".image-default-button");if(preview.length){preview.removeClass().addClass("thumbnail thumbnail-image").html('<img src="'+control.params.default+'" alt="" />')}if(removeButton.length){removeButton.show();defaultButton.hide()}})}}}});