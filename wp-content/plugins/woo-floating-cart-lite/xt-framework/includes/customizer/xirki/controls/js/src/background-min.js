wp.customize.controlConstructor["xirki-background"]=wp.customize.Control.extend({ready:function(){"use strict";var control=this;if(!_.isUndefined(window.xirkiControlLoader)&&_.isFunction(xirkiControlLoader)){xirkiControlLoader(control)}else{control.initXirkiControl()}},initXirkiControl:function(){var control=this,value=control.setting._value,picker=control.container.find(".xirki-color-control");if(_.isUndefined(value["background-image"])||""===value["background-image"]){control.container.find(".background-wrapper > .background-repeat").hide();control.container.find(".background-wrapper > .background-position").hide();control.container.find(".background-wrapper > .background-size").hide();control.container.find(".background-wrapper > .background-attachment").hide()}picker.wpColorPicker({change:function(){setTimeout(function(){control.saveValue("background-color",picker.val())},100)}});control.container.on("change",".background-repeat select",function(){control.saveValue("background-repeat",jQuery(this).val())});control.container.on("change click",".background-size input",function(){control.saveValue("background-size",jQuery(this).val())});control.container.on("change",".background-position select",function(){control.saveValue("background-position",jQuery(this).val())});control.container.on("change click",".background-attachment input",function(){control.saveValue("background-attachment",jQuery(this).val())});control.container.on("click",".background-image-upload-button",function(e){var image=wp.media({multiple:false}).open().on("select",function(){var uploadedImage=image.state().get("selection").first(),previewImage=uploadedImage.toJSON().sizes.full.url,imageUrl,imageID,imageWidth,imageHeight,preview,removeButton;if(!_.isUndefined(uploadedImage.toJSON().sizes.medium)){previewImage=uploadedImage.toJSON().sizes.medium.url}else if(!_.isUndefined(uploadedImage.toJSON().sizes.thumbnail)){previewImage=uploadedImage.toJSON().sizes.thumbnail.url}imageUrl=uploadedImage.toJSON().sizes.full.url;imageID=uploadedImage.toJSON().id;imageWidth=uploadedImage.toJSON().width;imageHeight=uploadedImage.toJSON().height;if(""!==imageUrl){control.container.find(".background-wrapper > .background-repeat, .background-wrapper > .background-position, .background-wrapper > .background-size, .background-wrapper > .background-attachment").show()}control.saveValue("background-image",imageUrl);preview=control.container.find(".placeholder, .thumbnail");removeButton=control.container.find(".background-image-upload-remove-button");if(preview.length){preview.removeClass().addClass("thumbnail thumbnail-image").html('<img src="'+previewImage+'" alt="" />')}if(removeButton.length){removeButton.show()}});e.preventDefault()});control.container.on("click",".background-image-upload-remove-button",function(e){var preview,removeButton;e.preventDefault();control.saveValue("background-image","");preview=control.container.find(".placeholder, .thumbnail");removeButton=control.container.find(".background-image-upload-remove-button");control.container.find(".background-wrapper > .background-repeat").hide();control.container.find(".background-wrapper > .background-position").hide();control.container.find(".background-wrapper > .background-size").hide();control.container.find(".background-wrapper > .background-attachment").hide();if(preview.length){preview.removeClass().addClass("placeholder").html("No file selected")}if(removeButton.length){removeButton.hide()}})},saveValue:function(property,value){var control=this,input=jQuery("#customize-control-"+control.id.replace("[","-").replace("]","")+" .background-hidden-value"),val=control.setting._value;val[property]=value;jQuery(input).attr("value",JSON.stringify(val)).trigger("change");control.setting.set(val)}});