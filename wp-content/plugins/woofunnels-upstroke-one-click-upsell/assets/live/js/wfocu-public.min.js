"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var wfocuCommons={hooks:{action:{},filter:{}},addAction:function(t,e,a,i){this.addHook("action",t,e,a,i)},addFilter:function(t,e,a,i){this.addHook("filter",t,e,a,i)},doAction:function(t){this.doHook("action",t,arguments)},applyFilters:function(t){return this.doHook("filter",t,arguments)},removeAction:function(t,e){this.removeHook("action",t,e)},removeFilter:function(t,e,a){this.removeHook("filter",t,e,a)},addHook:function(t,e,a,i,s){null==this.hooks[t][e]&&(this.hooks[t][e]=[]);var o=this.hooks[t][e];null==s&&(s=e+"_"+o.length),null==i&&(i=10),this.hooks[t][e].push({tag:s,callable:a,priority:i})},doHook:function(t,e,a){if(a=Array.prototype.slice.call(a,1),null!=this.hooks[t][e]){var i,s=this.hooks[t][e];s.sort(function(t,e){return t.priority-e.priority});for(var o=0;o<s.length;o++)"function"!=typeof(i=s[o].callable)&&(i=window[i]),"action"==t?i.apply(null,a):a[0]=i.apply(null,a)}if("filter"==t)return a[0]},removeHook:function(t,e,a,i){if(null!=this.hooks[t][e])for(var s=this.hooks[t][e],o=s.length-1;0<=o;o--)null!=i&&i!=s[o].tag||null!=a&&a!=s[o].priority||s.splice(o,1)},parseURL:function(t){var e,a,i,s=document.createElement("a"),o={};for(s.href=t,e=s.search.replace(/^\?/,"").split("&"),i=0;i<e.length;i++)o[(a=e[i].split("="))[0]]=a[1];return{protocol:s.protocol,host:s.host,hostname:s.hostname,port:s.port,pathname:s.pathname,search:s.search,searchObject:o,hash:s.hash}},wfab_deparam1:function(t){for(var e=function(t,e,a){if(1<e.length){var i=e.shift();void 0===t[i]&&(t[i]=""==e[0]?[]:{}),arguments.callee(t[i],e,a)}else t instanceof Array?t.push(a):t[e]=a},a=t.split("&"),i={},s=0;s<a.length;s++){var o=a[s].split("="),r=decodeURIComponent(o[0]),n=decodeURIComponent(o[1]),c=r.match(/(^[^\[]+)(\[.*\]$)?/),p=c[1];(c=c[2]?c[2].match(/(?=\[(.*)\]$)/)[1].split("]["):[]).unshift(p),e(i,c,n)}return i}};!function(v){var b={ViewsRegistered:!1,items:[],itemsData:[],itemsPrices:[],itemsTaxes:[],itemsDataDisplay:[],shippingCost:0,shippingOptions:[],shippingPreference:null,ShippingRaw:[],globalVars:window.wfocu_vars,ShippingFlatApplied:{},ShippingCall:null,shippingTax:0,inOfferTransaction:!1,inOfferTransactionData:{},sendStatus:!1,isSending:!1,addItem:function(t,e,a,i){void 0===a&&(a=[]),this.items.push(t),!1===i?this.itemsTaxes.push(this.getTaxInfo(t)):this.itemsTaxes.push(i),this.itemsData.push(a),this.itemsDataDisplay.push(this.prepareDisplay(a,t)),this.needsDynamicShipping(t)?(this.resetShipping(),this.processShipping()):this.needsFlatShipping(t)&&(this.resetShipping(),this.applyFlatShipping()),this.itemsPrices.push(e)},validateBeforeAddItem:function(t,e,a){var i,s;if(""===a){if(void 0===this.globalVars.offer_data.products[t])return!1;if("variable"===this.globalVars.offer_data.products[t].type)return!1;if(!0===this.globalVars.offer_data.products[t].backorders_allowed)return!0;if(-1===(i=parseInt(this.globalVars.offer_data.products[t].max_qty)))return!0;if(s=parseInt(this.globalVars.offer_data.products[t].quantity),i<this.getQuantity(t)+s)return!1}else{if(void 0===this.globalVars.offer_data.products[t])return!1;var o=v('.wfocu_variation_selector_wrap[data-key="'+t+'"]').attr("data-variations-stock");if(-1===(i=JSON.parse(o)[a]))return!0;if(null===i)return!0;if(i=parseInt(i),s=parseInt(this.globalVars.offer_data.products[t].quantity),i<this.getQuantity(t,a)+s)return!1}return!0},getQuantity:function(t,e){var a,i=0;if(void 0===e)for(var s in a=this.getItems())a[s]===t&&i++;else{var o=this.getItemsData();for(var r in a=this.getItems())if(a[r]===t)for(var n in o[r]){var c=o[r][n];/_wfocu_variation=/i.test(c)&&e===c.slice(17,c.length)&&i++}}return parseInt(this.globalVars.offer_data.products[t].quantity)*i},getItemDataByIndex:function(t,i){var e=this.itemsData[t],s="";return v.each(e,function(t,e){var a=e.split("=");i===a[0]&&(s=a[1])}),s},DisableButtonState:function(t){var e=v(".wfocu_upsell");void 0!==t&&(e=v('.wfocu_upsell[data-key="'+t+'"]')),e.addClass("disabled")},EnableButtonState:function(t){var e=v(".wfocu_upsell");void 0!==t&&(e=v('.wfocu_upsell[data-key="'+t+'"]')),e.removeClass("disabled")},removeItem:function(t){var e=this.items[t];this.items.splice(t,1),this.itemsData.splice(t,1),this.itemsTaxes.splice(t,1),this.itemsDataDisplay.splice(t,1),this.itemsPrices.splice(t,1),this.needsDynamicShipping(e)?(this.resetShipping(),this.processShipping()):this.needsFlatShipping(e)&&(this.resetShipping(),this.applyFlatShipping())},clean:function(){this.items=[],this.itemsData=[],this.itemsPrices=[],this.itemsTaxes=[],this.itemsDataDisplay=[],this.shippingCost=0,this.shippingOptions=[],this.ShippingRaw=[],this.ShippingFlatApplied={},this.shippingTax=0},getItems:function(){return this.items},getItemsData:function(){return this.itemsData},getItemsPrices:function(){return this.itemsPrices},getItemsQty:function(t){return parseInt(this.globalVars.offer_data.products[t].quantity)},getItemsDataDislay:function(){return this.itemsDataDisplay},getItemDisplayPrice:function(t){var e=this.itemsPrices[t],a=this.itemsTaxes[t];return!0===this.globalVars.global.include_taxes&&!0===this.globalVars.offer_data.is_show_confirmation?e:e+a},getSubtotalPrice:function(){var t=this.sum(this.getItemsPrices()),e=this.sum(this.itemsTaxes);return!0===this.globalVars.global.include_taxes&&!0===this.globalVars.offer_data.is_show_confirmation?t:t+e},MaybeAddShipping:function(t,e,a){if(""===a){var i,s=this.getShippingByKey(t);if(!1===s)return;if(!1===b.isEmpty(s.shipping))for(var o in b.ShippingRaw.push(s.shipping),s.shipping)!1!==(i=b.getShippingDifference(s.shipping[o],s.shipping_prev))&&b.shippingOptions.push({label:b.getShippingLabel(s.shipping[o]),value:o,diff:i,selected:""});else if(!1===b.isEmpty(s.free_shipping))for(var r in b.ShippingRaw.push(s.free_shipping),s.free_shipping)i=b.getShippingDifference(s.free_shipping[r],s.shipping_prev),!0===b.isFloatOrNum(i)&&b.shippingOptions.push({label:b.getShippingLabel(s.free_shipping[r]),value:r,diff:i,selected:""})}else _.has(y.shippingCharges,a)&&b.shippingOptions.push({label:y.shippingCharges[a].label,value:y.shippingCharges[a].method,diff:{cost:y.shippingCharges[a].cost,tax:y.shippingCharges[a].tax},selected:""});0<b.shippingOptions.length&&(b.shippingOptions[0].selected="checked",b.setShipping(parseFloat(b.shippingOptions[0].diff.cost)),b.setShippingTax(parseFloat(b.shippingOptions[0].diff.tax)))},getShippingByKey:function(t){return void 0!==this.globalVars.offer_data.products[t]&&(void 0!==this.globalVars.offer_data.products[t].shipping&&this.globalVars.offer_data.products[t].shipping)},applyFlatShipping:function(){var t=[],e=[],a=[];for(var i in this.items)this.globalVars.offer_data.products[this.items[i]].needs_shipping&&"flat"===this.shippingPreference&&0<this.globalVars.offer_data.products[this.items[i]].shipping_cost_flat&&-1===a.indexOf(this.items[i])&&(t.push(this.globalVars.offer_data.products[this.items[i]].shipping_cost_flat),e.push(this.globalVars.offer_data.products[this.items[i]].shipping_cost_flat_tax),a.push(this.items[i]));0<a.length&&(b.shippingOptions.push({label:b.globalVars.global.flat_shipping_label,value:"fixed",diff:{cost:this.sum(t),tax:this.sum(e)},selected:""}),b.shippingOptions[0].selected="checked",b.setShipping(parseFloat(b.shippingOptions[0].diff.cost)),b.setShippingTax(parseFloat(b.shippingOptions[0].diff.tax)))},getShippingFlatByKey:function(t){return void 0!==this.globalVars.offer_data.products[t]&&(void 0!==this.globalVars.offer_data.products[t].shipping_cost_flat&&{cost:this.globalVars.offer_data.products[t].shipping_cost_flat,tax:this.globalVars.offer_data.products[t].shipping_cost_flat_tax})},resetShipping:function(){this.shippingCost=0,this.ShippingRaw=[],this.shippingOptions=[]},prepareDisplay:function(t,o){if(0===t.length)return t;var r=[];return v.each(t,function(t,e){var a=e.split("=");if("_"!==a[0].charAt(0)){var i=a[1].replace(/\+/g," "),s=y.OptionsHtml[o][a[0]][i];_.isUndefined(s)||r.push({title:b.getDataTitle(a[0]),val:s.innerText})}}),r},getTaxInfo:function(t){return void 0===this.globalVars.offer_data.products[t]?0:void 0===this.globalVars.offer_data.products[t].tax?0:this.globalVars.offer_data.products[t].tax},needsFlatShipping:function(t){return!1===this.globalVars.is_free_shipping&&!0===this.globalVars.offer_data.products[t].needs_shipping&&"flat"===this.globalVars.offer_data.shipping_preferece},needsDynamicShipping:function(t){return!1===this.globalVars.is_free_shipping&&!0===this.globalVars.offer_data.products[t].needs_shipping&&"dynamic"===this.globalVars.offer_data.shipping_preferece},getItemsNeedDynamicShipping:function(){var a=[];return v(this.getItems()).each(function(t,e){b.needsDynamicShipping(e)&&a.push(e)}),a},processShipping:function(){var t=this.getItemsNeedDynamicShipping();0!==t.length?this.ShippingCall=v.ajax({type:"POST",url:this.globalVars.wc_ajax_url.toString().replace("%%endpoint%%","wfocu_front_calculate_shipping"),data:{action:"wfocu_front_calculate_shipping",nonce:this.globalVars.nonces.wfocu_calculate_shipping,"wfocu-si":this.globalVars.session_id,items:t,itemsData:this.getItemsData()},beforeSend:function(){b.initiateLoader(),null!==b.ShippingCall&&b.ShippingCall.abort()},success:function(t){var e;if(b.clearLoader(),_.has(t,"success")){var a=!1;void 0!==t.data.override&&(a=t.data.override);var i=[];if(!1===b.isEmpty(t.data.free_shipping))for(var s in b.ShippingRaw.push(t.data.free_shipping),t.data.free_shipping)!1!==(e=b.getShippingDifference(t.data.free_shipping[s],t.data.shipping_prev))&&(i.push(s),b.shippingOptions.push({label:b.getShippingLabel(t.data.free_shipping[s]),value:s,diff:e,selected:"",tax:0}));if(!1===b.isEmpty(t.data.shipping)){for(var o in t.data.shipping)for(var r in t.data.shipping[o])-1===_.indexOf(i,r)&&(a&&(t.data.shipping_prev.cost=0),!1!==(e=b.getShippingDifference(t.data.shipping[o][r],t.data.shipping_prev))&&b.shippingOptions.push({label:b.getShippingLabel(t.data.shipping[o][r]),value:r,diff:e,selected:"",override:a}));b.ShippingRaw.push(t.data.shipping)}0<b.shippingOptions.length&&(b.shippingOptions[0].selected="checked",b.setShipping(parseFloat(b.shippingOptions[0].diff.cost)),b.setShippingTax(parseFloat(b.shippingOptions[0].diff.tax))),b.doShow()?b.render():"hold"===b.sendStatus?b.sendBucket():b.render()}else b.render();b.ShippingCall=null}}):b.render()},getShippingLabel:function(t){return t.label},getShippingDifference:function(t,e,a){void 0===a&&(a=!0);var i=parseFloat(t.cost)+parseFloat(t.shipping_tax),s=parseFloat(e.cost)+parseFloat(e.tax),o=this.unformatPrices(i-parseFloat(s)),r=this.PreCalculateTotalForShipping(o);if(a&&r<=0)return!1;var n=this.unformatPrices(t.shipping_tax)-this.unformatPrices(e.tax);return{cost:o-n,tax:n}},getShippingPrintDiff:function(a){var i=0;return v(this.shippingOptions).each(function(t,e){e.value===a&&(i=e.diff.cost,!1===b.globalVars.global.include_taxes&&(i+=e.diff.tax))}),i},isFloatOrNum:function(t){var e=Number(t)===t&&t%1!=0,a=Number(t)===t&&t%1==0;return e||a},isEmpty:function(t){for(var e in t)if(_.has(t,e))return!1;return!0},getDataTitle:function(t){return 0<v('select[data-attribute_name="'+t+'"]').length?v('select[data-attribute_name="'+t+'"]').parent("td").eq(0).attr("data-attribute-title"):t},doShow:function(){return this.globalVars.offer_data.is_show_confirmation},render:function(){var t=v(".wfocu-cart-components"),e=window.wp.template("wfocu-bucket-template");t.html(e({Bucket:b})).promise().done(function(){b.reveal(),b.bindHandlers(),v(document).trigger("wfocuBucketConfirmationRendered",[b])})},sum:function(t){return t.reduce(function(t,e){return t+e},0)},PreCalculateTotalForShipping:function(t){var e=this.sum(this.getItemsPrices()),a=this.getTaxTotal();return parseFloat(e)+a+parseFloat(t)},getTaxTotal:function(){var t=this.sum(this.itemsTaxes),e=this.shippingTax;return parseFloat(t)+e},getTotal:function(){return parseFloat(this.sum(this.getItemsPrices()))+this.getTaxTotal()+this.shippingCost},reveal:function(){jQuery("body").addClass("wfocu-sidecart-open")},hide:function(){jQuery("body").hasClass("wfocu-sidecart-open")&&(jQuery("body").removeClass("wfocu-sidecart-open"),jQuery(".wfocu-offer-btn-wrap").removeClass("wfocu-def-hide")),0===b.getItems().length&&jQuery(".wfocu-offer-btn-wrap").addClass("wfocu-def-hide")},initiateLoader:function(){jQuery(".wfocu-sidebar-cart .wfocu-cart-components").addClass("wfocu-loading"),jQuery(".wfocu-sidebar-cart .wfocu-mc-close").addClass("wfocu-disable-close")},clearLoader:function(){jQuery(".wfocu-sidebar-cart .wfocu-cart-components").removeClass("wfocu-loading"),jQuery(".wfocu-sidebar-cart .wfocu-mc-close").removeClass("wfocu-disable-close")},init:function(){this.placeOverlay(),!0!==this.globalVars.is_preview&&(this.prepareActionLinks(),this.bindBaseHandlers(),this.shippingPreference=this.globalVars.offer_data.shipping_preferece,this.bindHandlers(),this.hideOutOfStockLinks(),b.updateViews(),v(document).trigger("wfocuBucketCreated",[this]))},bindBaseHandlers:function(){v(document).on("click",".wfocu-black-overlay",function(){!1===v(".wfocu-sidebar-cart .wfocu-cart-components").hasClass("wfocu-loading")&&b.hide()}),v("body").on("click",".wfocu-confirm-order-btn",function(){return b.render(),!1}),v(".wfocu_upsell").on("click",function(){var t=b.globalVars.offer_data.is_show_confirmation,e=v(this).data("key"),a=[],i=b.getPriceByKey(e),s=!1,o="",r=v('.wfocu-select-qty-input[data-key="'+e+'"]').val();if(void 0===r&&(r=1),"complete"===document.readyState){if(0<v('form.wfocu_variation_selector_form[data-key="'+v(this).data("key")+'"]').length){if(v(this).hasClass("disabled")){var n=v('form.wfocu_variation_selector_form[data-key="'+v(this).data("key")+'"]').eq(0);return v("html, body").stop().animate({scrollTop:n.offset().top-100},1e3,"swing",function(){}),alert(b.globalVars.messages.i18n_no_matching_variations_text),!1}o=v('form.wfocu_variation_selector_form[data-key="'+v(this).data("key")+'"] input[name="_wfocu_variation"]').val();var c=v('form.wfocu_variation_selector_form[data-key="'+v(this).data("key")+'"]').eq(0).serialize(),p=v('form.wfocu_variation_selector_form[data-key="'+v(this).data("key")+'"] .wfocu_variation_selector_wrap').attr("data-prices");(p=JSON.parse(p))[o]&&(i=p[o].price_excl_tax,s=p[o].price_incl_tax-p[o].price_excl_tax);var l=wfocuCommons.wfab_deparam1(c);for(var f in l)a.push(f+"="+l[f])}if(0<v('form.wfocu_attributes_selector_form[data-key="'+v(this).data("key")+'"]').length){if(v(this).hasClass("disabled")){var u=v('form.wfocu_attributes_selector_form[data-key="'+v(this).data("key")+'"]').eq(0);return v("html, body").stop().animate({scrollTop:u.offset().top-100},1e3,"swing",function(){}),alert(b.globalVars.messages.i18n_no_matching_variations_text),!1}a=""!==(a=v('form.wfocu_attributes_selector_form[data-key="'+v(this).data("key")+'"]').eq(0).serialize())?a.split("&"):[]}if(v(this).hasClass("disabled"))return!1;var h=b.validateBeforeAddItem(e,a,o);if(i=wfocuCommons.applyFilters("wfocu_additem_price",i,e,o),s=wfocuCommons.applyFilters("wfocu_additem_taxes",s,e,o),a=wfocuCommons.applyFilters("wfocu_additem_data",a,e,o),!1===h)return alert(b.globalVars.messages.i18n_no_matching_variations_text),!1;if(!1!==t){for(var d=0;d<r;d++)b.addItem(e,i,a,s);return b.render(),!1}b.clean();for(var _=0;_<r;_++)b.addItem(e,i,a,s);b.sendBucket()}}),v("body").on("click",".wfocu_skip_offer",function(){b.skip(this)})},bindHandlers:function(){v(".wfocu_remove_item").click(function(){var t=v(this).attr("data-index");"number"==typeof parseInt(t)&&(b.removeItem(t),b.render())}),v(".wfocu-mc-close a").on("click",function(){b.hide()}),v(".wfocu-mc-button").click(function(){try{b.sendBucket()}catch(t){console.log(t)}}),v('.wfocu_ship_selector input[type="radio"]').change(function(){var t=v(this).val();for(var e in b.shippingOptions)t===b.shippingOptions[e].value?(b.shippingOptions[e].selected="checked",b.setShipping(parseFloat(b.shippingOptions[e].diff.cost)),b.setShippingTax(parseFloat(b.shippingOptions[e].diff.tax))):b.shippingOptions[e].selected="";b.render()}),v(".wfocu_skip_offer_mc").click(function(){b.skip(this)}),v("select.wfocu-select-qty-input").on("change",function(){var t=v(this),e=t.attr("data-key");v('.wfocu-select-qty-input[data-key="'+e+'"]').val(t.val())})},updateViews:function(){if(!0!==this.ViewsRegistered&&"1"!==this.localStorage.get("wfocu_"+this.globalVars.offer+"_"+this.globalVars.session_id)){var t={};for(var e in this.globalVars.offer_data.products)t[e]={id:this.globalVars.offer_data.products[e].id,name:this.globalVars.offer_data.products[e].name};v.post(this.globalVars.wc_ajax_url.toString().replace("%%endpoint%%","wfocu_front_register_views"),{action:"wfocu_front_register_views","wfocu-si":this.globalVars.session_id,nonce:this.globalVars.nonces.wfocu_register_views,data:{offer_type:this.globalVars.offer_type,offer_type_index:this.globalVars.offer_type_index,products:t}},function(){b.localStorage.set("wfocu_"+b.globalVars.offer+"_"+b.globalVars.session_id,"1")}),this.ViewsRegistered=!0}},getChosenShipping:function(){if(0===this.shippingOptions.length)return null;var a=null;return v(this.shippingOptions).each(function(t,e){"checked"===e.selected&&(a=e)}),a},HandleResponse:function(t){var e=1e3;Object.prototype.hasOwnProperty.call(t,"success")&&!0===t.success?b.swal.show({text:wfocu_vars.messages.offer_success_message_pop,type:"success"}):Object.prototype.hasOwnProperty.call(t,"success")&&"onhold"===t.success?wfocuSweetalert2.getContent().querySelector("#wfocuswal-content #wfocu-swal-content").textContent=t.message:(e=1500,b.swal.show({text:wfocu_vars.messages.offer_msg_pop_failure,type:"warning"})),setTimeout(function(){void 0!==t.data&&void 0!==t.data.redirect_url?window.location=t.data.redirect_url:window.location=wfocu_vars.order_received_url},e)},ShowLoading:function(){this.swal.show(wfocu_vars.loader)},skip:function(t){try{v(t).prop("disable",!0),v(t).prop("disabled",!0),b.swal.show(this.globalVars.loader),v.ajax({type:"POST",url:this.globalVars.wc_ajax_url.toString().replace("%%endpoint%%","wfocu_front_offer_skipped"),data:{action:"wfocu_front_offer_skipped",nonce:this.globalVars.nonces.wfocu_front_offer_skipped,data:{offer_type:this.globalVars.offer_type,offer_type_index:this.globalVars.offer_type_index},"wfocu-si":this.globalVars.session_id},success:function(t){_.has(t,"success")&&(window.location=t.data.redirect_url)},error:function(t){void 0!==window.wfocu_vars.order_received_url&&(window.location=window.wfocu_vars.order_received_url+"&ec="+t.status)}})}catch(t){v.ajax({type:"POST",url:this.globalVars.wc_ajax_url.toString().replace("%%endpoint%%","wfocu_front_catch_error"),data:{action:"wfocu_front_catch_error",nonce:this.globalVars.nonces.wfocu_front_catch_error,message:t,"wfocu-si":this.globalVars.session_id}}),void 0!==b.globalVars.order_received_url&&(window.location=b.globalVars.order_received_url+"&ec="+t)}},getBucketSendData:function(){return wfocuCommons.applyFilters("wfocu_front_charge_data",{action:"wfocu_front_charge",nonce:this.globalVars.nonces.wfocu_charge,"wfocu-si":this.globalVars.session_id,items:this.getItems(),itemsData:this.getItemsData(),shipping:this.getChosenShipping(),totals:{itemsPrices:this.unformatPrices(this.getItemsPrices()),taxTotal:this.unformatPrices(this.getTaxTotal()),total:this.unformatPrices(this.getTotal())}})},sendBucket:function(){try{0===this.getItems().length&&this.handleSendBucketException("no items in the bucket");var t=this.getBucketSendData();if(!1===wfocuSweetalert2.isVisible()&&b.swal.show(this.globalVars.loader+'</br> <div id="wfocu-swal-content">'+this.globalVars.loading_text+"</div>"),0<b.getItemsNeedDynamicShipping().length&&!1===b.doShow()&&!1===b.sendStatus)return void(b.sendStatus="hold");if(v(document).trigger("wfocu_external",[b,t]),!0===b.inOfferTransaction)return;if(!0===b.isSending)return;b.isSending=!0,v.ajax({type:"POST",url:this.globalVars.wc_ajax_url.toString().replace("%%endpoint%%","wfocu_front_charge"),data:t,success:function(t){var e=1e3;b.isSending=!1,_.has(t,"success")?(e=1e3,!0===t.success?b.swal.show({text:window.wfocu_vars.messages.offer_success_message_pop,type:"success"}):"onhold"===t.success?wfocuSweetalert2.getContent().querySelector("#wfocuswal-content #wfocu-swal-content").textContent=t.message:(e=1500,b.swal.show({text:window.wfocu_vars.messages.offer_msg_pop_failure,type:"warning"}))):_.has(t,"result")&&"error"===t.result?(e=1500,b.swal.show({text:window.wfocu_vars.messages.offer_msg_pop_failure,type:"warning"})):void 0!==window.wfocu_vars.order_received_url&&(window.location=window.wfocu_vars.order_received_url),setTimeout(function(){void 0!==t.data&&void 0!==t.data.redirect_url?window.location=t.data.redirect_url:window.location=window.wfocu_vars.order_received_url},e)},error:function(t){if(b.isSending=!1,void 0!==window.wfocu_vars.order_received_url){var e=t.status;window.location=b.globalVars.order_received_url+"&ec="+e}}})}catch(t){this.handleSendBucketException(t)}},handleSendBucketException:function(t){v.ajax({type:"POST",url:this.globalVars.wc_ajax_url.toString().replace("%%endpoint%%","wfocu_front_catch_error"),data:{action:"wfocu_front_catch_error",nonce:this.globalVars.nonces.wfocu_front_catch_error,message:t,"wfocu-si":this.globalVars.session_id}}),void 0!==b.globalVars.order_received_url&&(window.location=b.globalVars.order_received_url+"&ec="+t)},setShipping:function(t){this.shippingCost=t},setShippingTax:function(t){this.shippingTax=t},getShipping:function(){return this.shippingCost},getKeyBYIndex:function(t){var e=_.allKeys(wfocu_vars.offer_data.fields);return _.isUndefined(e[t-1])?t:e[t-1]},convertLinksYes:function(t,e){var a=t.attr("href").substring(1);b.isValidKey(a)||(""===a&&(a=1),a=this.getKeyBYIndex(a)),b.isValidKey(a)&&(t.attr("href","javascript:void(0);"),t.attr("data-key",a),t.addClass("wfocu_upsell"),!1===b.globalVars.offer_data.settings.ask_confirmation&&t.addClass("wfocu_paypal_in_context_btn"),t.removeClass("wfocu_yes_btn"),v(e).removeClass("wfocu_yes_btn"))},convertLinksNo:function(t,e){t.attr("href","javascript:void(0);"),t.addClass("wfocu_skip_offer"),t.removeClass("wfocu_no_btn"),v(e).removeClass("wfocu_no_btn")},prepareActionLinks:function(){v('a[href*="wfocu-accept-link=yes"]').each(function(t,e){v(this).addClass("wfocu_yes_btn");var a=v(this).attr("href"),i=wfocuCommons.parseURL(a);_.isObject(i)&&_.has(i,"searchObject")&&_.isObject(i.searchObject)&&_.has(i.searchObject,"key")?v(this).attr("href","#"+i.searchObject.key):v(this).attr("href","")}),v('a[href*="wfocu-reject-link=yes"]').each(function(t,e){v(this).addClass("wfocu_no_btn"),v(this).attr("href","")}),v(".wfocu_yes_btn").each(function(t,e){var a,i=e;"A"===e.tagName?(a=v(e),b.convertLinksYes(a,i)):0<v(e).find("a").length&&v(e).find("a").each(function(t,e){var a=v(e);0<a.length&&b.convertLinksYes(a,i)})}),v(".wfocu_no_btn").each(function(t,e){var a,i=e;"A"===e.tagName?(a=v(e),b.convertLinksNo(a,i)):0<v(e).find("a").length&&v(e).find("a").each(function(t,e){var a=v(e);0<a.length&&b.convertLinksNo(a,i)})}),v(document).trigger("wfocuBucketLinksConverted",[b])},isValidKey:function(t){return void 0!==this.globalVars.offer_data.products[t]},placeOverlay:function(){if(0===v(".wfocu-offer-btn-wrap").length&&0<v("#tmpl-wfocu-body-next-template").length){var t=window.wp.template("wfocu-body-next-template");v("body").prepend(t({}))}},getPriceByKey:function(t){return void 0===this.globalVars.offer_data.products[t]?0:void 0===this.globalVars.offer_data.products[t].price?0:this.globalVars.offer_data.products[t].sale_price_excl_tax},hideOutOfStockLinks:function(){for(var t in this.globalVars.offer_data.products){if(_.has(this.globalVars.offer_data.products[t],"is_in_stock"))if(this.globalVars.offer_data.products[t].is_purchasable&&this.globalVars.offer_data.products[t].is_in_stock||b.DisableButtonState(t),!1===this.globalVars.offer_data.products[t].backorders_allowed&&-1!==this.globalVars.offer_data.products[t].max_qty)this.globalVars.offer_data.products[t].max_qty<parseInt(this.globalVars.offer_data.products[t].quantity)&&b.DisableButtonState(t)}},formatMoney:function(t){return accounting.formatMoney(t,{symbol:wfocu_wc_params.currency_format_symbol,decimal:wfocu_wc_params.currency_format_decimal_sep,thousand:wfocu_wc_params.currency_format_thousand_sep,precision:wfocu_wc_params.currency_format_num_decimals,format:wfocu_wc_params.currency_format})},formatPrice:function(t,e,a,i){return void 0===e&&(e=wfocu_wc_params.currency_format_num_decimals),void 0===a&&(a=wfocu_wc_params.currency_format_thousand_sep),void 0===i&&(i=wfocu_wc_params.currency_format_decimal_sep),parseFloat(accounting.formatNumber(t,e,a,i))},unformatPrices:function(t){if("object"!==_typeof(t))return accounting.toFixed(accounting.unformat(t),2);var e=[];for(var a in t)e.push(accounting.toFixed(accounting.unformat(t[a]),2));return e},expire:function(){v.post(this.globalVars.wc_ajax_url.toString().replace("%%endpoint%%","wfocu_front_offer_expired"),{action:"wfocu_front_offer_expired",nonce:this.globalVars.nonces.wfocu_offer_expired,"wfocu-si":this.globalVars.session_id},function(t){_.has(t,"success")&&(window.location=t.data.redirect_url)})},swal:{current:null,show:function(t){wfocuSweetalert2.isVisible()&&wfocuSweetalert2.close();var e={showCancelButton:!1,showConfirmButton:!1,allowOutsideClick:!1};"string"==typeof t?wfocuSweetalert2(v.extend(e,{html:t})):wfocuSweetalert2(v.extend(e,t))},hide:function(){wfocuSweetalert2.close()}},localStorage:{get:function(t){try{return localStorage.getItem(t)}catch(t){return!1}},set:function(t,e){try{return localStorage.setItem(t,e),!0}catch(t){return!1}}}};b.init();var y={snapshots:{},allOptions:{},anyAttributes:{},chosenVariations:{},shippingCharges:{},ShippingCallVariation:null,handlersAttached:[],OptionsHtml:{},init:function(){v(".wfocu_variation_selector_wrap").each(function(){var t=v(this).attr("data-key"),e=v(this).attr("data-variations"),a=v(this).attr("data-default");try{e=JSON.parse(e),y.snapshots[t]=defiant.getSnapshot(e),y.getAllAttributesNames(t),y.populateDropDowns(t);var i=y.query(t,'//*[@d:name="'+a+'"]');y.setUpDefault(t,i),-1===y.handlersAttached.indexOf(t)&&(y.attachHandlers(t),y.handlersAttached.push(t))}catch(t){console.error(t)}})},getAllAttributesNames:function(e){void 0===y.allOptions[e]&&(this.allOptions[e]={},y.OptionsHtml[e]={},v('.wfocu_variation_selector_wrap[data-key="'+e+'"] select').each(function(){var t=v(this).attr("name");y.allOptions[e][t]={},y.OptionsHtml[e][t]={},v(this).find("option").each(function(){y.OptionsHtml[e][t][v(this).attr("value")]=this,y.allOptions[e][t][v(this).attr("value")]=this.innerText})}))},getDropDownValues:function(t){var e=[];return v(t).find("option").each(function(){e.push(v(this).val())}),e},populateDropDowns:function(s){this.anyAttributes[s]=[],v('.wfocu_variation_selector_wrap[data-key="'+s+'"] select').each(function(){var t=v(this).attr("name"),e=y.query(s,"//@"+t);""===e[0]&&y.anyAttributes[s].push(t);var a=y.getDropDownValues(this),i=y.createOptions(e,t,s,a);i&&v(this).html(i.innerHTML)})},setUpDefault:function(a,i){v('.wfocu_variation_selector_wrap[data-key="'+a+'"] select').each(function(){var t=v(this).attr("name");if(!y.isAttributeAny(a,t)){var e=i[0]["@"+t];!0===window.wfocu_vars.show_variation_default&&v(this).val(e).prop(e)}});var t=b.globalVars.offer_data.products[a].variations_data.default,e=v('.wfocu_variation_selector_wrap[data-key="'+a+'"]').attr("data-shipping-hash"),s=JSON.parse(e),o=_.has(s,t)?s[t]:"",r=[];for(var n in s)o===s[n]&&r.push(n);if(0<v(".shop_attributes td.product_weight").length){var c=v('.wfocu_variation_selector_wrap[data-key="'+a+'"]').attr("data-weight-html"),p=JSON.parse(c);v(".shop_attributes td.product_weight").html(p[t])}if(0<v(".shop_attributes td.product_dimensions").length){var l=v('.wfocu_variation_selector_wrap[data-key="'+a+'"]').attr("data-dimensions"),f=JSON.parse(l);v(".shop_attributes td.product_dimensions").html(f[t])}if(!0===b.globalVars.offer_data.products[a].needs_shipping&&_.has(b.globalVars.offer_data.products[a],"shipping"))if(b.isEmpty(b.globalVars.offer_data.products[a].shipping.shipping)&&b.isEmpty(b.globalVars.offer_data.products[a].shipping.free_shipping))for(var u in r)y.shippingCharges[r[u]]={cost:0,tax:0,method:"",label:""};else if(!1===b.isEmpty(b.globalVars.offer_data.products[a].shipping.shipping))for(var h in b.globalVars.offer_data.products[a].shipping.shipping){var d=b.getShippingDifference(b.globalVars.offer_data.products[a].shipping.shipping[h],b.globalVars.offer_data.products[a].shipping.shipping_prev,!1);if(!1!==d)for(var g in r)y.shippingCharges[r[g]]={cost:d.cost,tax:d.tax,method:h,label:b.globalVars.offer_data.products[a].shipping.shipping[h].label}}else if(!1===b.isEmpty(b.globalVars.offer_data.products[a].shipping.free_shipping))for(var w in b.globalVars.offer_data.products[a].shipping.free_shipping)for(var m in r)y.shippingCharges[r[m]]={cost:0,tax:0,method:w,label:b.globalVars.offer_data.products[a].shipping.free_shipping[w].label};v(document).trigger("wfocu_variation_selected",[a,t])},getOptionName:function(t,e,a){return void 0===y.allOptions[t]?"":void 0===y.allOptions[t][e]?"":void 0===y.allOptions[t][e][a]?"":y.allOptions[t][e][a]},unique:function(t){return t.filter(function(t,e,a){return e===a.indexOf(t)})},createOptions:function(t,e,a,i){if(this.isAttributeAny(a,e))return v('.wfocu_variation_selector_wrap[data-key="'+a+'"] select[name="'+e+'"] option[value=""]').remove(),v('.wfocu_variation_selector_wrap[data-key="'+a+'"] select[name="'+e+'"]').get(0).selectedIndex=0,"";var s=this.unique(t);s.sort(function(t,e){return _.indexOf(i,t)<_.indexOf(i,e)?-1:_.indexOf(i,t)>_.indexOf(i,e)?1:0});var o=document.createElement("select");if(!0!==window.wfocu_vars.show_variation_default){var r=document.createElement("option");r.value="-1",r.innerText=window.wfocu_vars.no_variation_text,o.appendChild(r)}for(var n in s){var c=y.OptionsHtml[a][e][s[n]];o.appendChild(c)}return o},isAttributeAny:function(t,e){return void 0!==y.anyAttributes[t]&&-1<y.anyAttributes[t].indexOf(e)},query:function(t,e){var a=this.getSnapShot(t);return defiant.json.search(a,e)},getSnapShot:function(t){if(this.snapshots&&_.has(this.snapshots,t))return this.snapshots[t]},preparePrices:function(t,e){_.has(y.shippingCharges,e)||b.globalVars.offer_data.shipping_preferece,this.populatePrices(t,e)},populatePrices:function(t,e){var a,i,s=v('form.wfocu_variation_selector_form[data-key="'+t+'"] .wfocu_variation_selector_wrap').attr("data-prices"),o=0;(s=JSON.parse(s))[e]&&(o=s[e]);var r=o.price_incl_tax_raw,n=o.regular_price_incl_tax_raw;!1===window.wfocu_vars.is_show_price_with_tax&&(r=o.price_excl_tax_raw,n=o.regular_price_excl_tax),a=void 0!==y.shippingCharges[e]?y.shippingCharges[e].cost+y.shippingCharges[e].tax+r:r;var c=(i=void 0!==y.shippingCharges[e]?y.shippingCharges[e].cost+y.shippingCharges[e].tax+n:n)-a,p=b.formatPrice((i-a)/i*100,0);v("span.wfocu_variable_price_sale[data-key='"+t+"']").html(b.formatMoney(a)).show();var l=window.wfocu_vars.offer_data.products[t].quantity;a!==i?(v("span.wfocu_variable_price_regular[data-key='"+t+"']").html(b.formatMoney(i)),v("span.wfocu_variable_price_regular[data-key='"+t+"']").show()):(v("span.wfocu_variable_price_regular[data-key='"+t+"']").html(b.formatMoney(i)),v("span.wfocu_variable_price_regular[data-key='"+t+"']").not(".wfocu_tags").hide()),v("span.wfocu_variable_price_regular.wfocu_tags[data-key='"+t+"']").html(b.formatMoney(i)),v("span.wfocu_variable_price_save_value[data-key='"+t+"']").html(b.formatMoney(c)),v("span.wfocu_variable_price_save_percentage[data-key='"+t+"']").html(p+"%"),v("span.wfocu_variable_price_save_percentage_combo[data-key='"+t+"']").html(t+b.formatMoney(c)+" ("+p+"%)"),v("span.wfocu_single_unit_price[data-key='"+t+"']").html(b.formatMoney(a/parseInt(l))),v(document).trigger("wfocu_populatePrices",[a,i,t,s,e,b])},attachHandlers:function(t){v('.wfocu_variation_selector_wrap[data-key="'+t+'"] select').each(function(){v(this).on("change",function(){var t=v(this).parents(".wfocu_variation_selector_wrap").eq(0).attr("data-key"),e=v('.wfocu_variation_selector_wrap[data-key="'+t+'"]').find('select[name="'+v(this).attr("name")+'"]').not(v(this));0<e.length&&e.val(v(this).val()),y.processVariationSelection(t)})})},processVariationSelection:function(a){var i=[];if(v('.wfocu_variation_selector_wrap[data-key="'+a+'"]:first select').each(function(){var t=v(this).val(),e=v(this).attr("name");y.isAttributeAny(a,e)||i.push("@"+e+"='"+t.replace(/'/g,"\\'")+"'")}),i&&0<i.length){var t=this.query(a,"//*["+i.join(" and ")+"]");if(t&&0<t.length){if(this.chosenVariations[a]={},this.chosenVariations[a]=t[0].id,v('.wfocu_variation_selector_wrap[data-key="'+a+'"] input[name="_wfocu_variation"]').val(this.chosenVariations[a]),y.preparePrices(a,this.chosenVariations[a]),v(document).trigger("wfocu_variation_selected",[a,this.chosenVariations[a]]),0<v(".shop_attributes td.product_weight").length){var e=v('.wfocu_variation_selector_wrap[data-key="'+a+'"]').attr("data-weight-html"),s=JSON.parse(e);v(".shop_attributes td.product_weight").html(s[this.chosenVariations[a]])}if(0<v(".shop_attributes td.product_dimensions").length){var o=v('.wfocu_variation_selector_wrap[data-key="'+a+'"]').attr("data-dimensions"),r=JSON.parse(o);v(".shop_attributes td.product_dimensions").html(r[this.chosenVariations[a]])}b.EnableButtonState(a)}else b.DisableButtonState(a),v('.wfocu_variation_selector_wrap[data-key="'+a+'"] input[name="_wfocu_variation"]').val("")}}};v(document).ready(function(){y.init()})}(jQuery);